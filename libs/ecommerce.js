/*! For license information please see ecommerce.js.LICENSE.txt */
(()=>{var e={1747:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ECommerceStreamAlarms=void 0,(n=t.ECommerceStreamAlarms||(t.ECommerceStreamAlarms={})).HEARTBEAT="E_COMMERCE_HEARTBEAT_ALARM",n.COUPON_DOMAIN="E_COMMERCE_COUPON_CONFIG_ALARM",n.PREVENT_DUPLICATION="E_COMMERCE_STREAM_PREVENT_DUPLICATION"},1578:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.useStream=t.createStream=void 0,n(8660);const o=n(2327),a=n(564),s=n(7159),c=n(4991),u=n(4939),l=n(3252),h=n(3314),f=n(8826),d=n(1747),g=n(5470),p=n(4268);let y,v=!1,_=!1;const m=[],b=e=>{const{watchers:t,version:n}=e.di().get(g.ConfigInjections.config);if(!t)return;const r=e.di().get(l.BgInjection.metaInfoManager);for(const{name:e,version:i}of t){const t={type:p.EcommerceMetaInfoEvents.heartBeat,details:{marketplace:e,libVersion:n.lib,templateVersion:i}};r.send(t)}},w=async e=>{(await(0,t.useStream)()).di().get(l.BgInjection.webNavigationHandler).onCreatedNavigationTarget(e)},S=async e=>{(await(0,t.useStream)()).di().get(l.BgInjection.webNavigationHandler).onBeforeNavigate(e)},C=async e=>{const n=await(0,t.useStream)(),r=n.di().get(l.BgInjection.webNavigationHandler),i=n.di().get(l.BgInjection.observer);r.onCompleted(e),i.emit(o.InternalMessageBgType.INIT_COMPLETED,e)};chrome.webNavigation?.onBeforeNavigate?.addListener(S),chrome.webNavigation?.onCreatedNavigationTarget?.addListener(w),chrome.webNavigation?.onCompleted?.addListener(C),chrome.tabs.onRemoved.addListener((async e=>{const n=await(0,t.useStream)(),r=n.di().get(l.BgInjection.runtimeStorage),i=n.di().get(l.BgInjection.webNavigationStorage);n.di().get(l.BgInjection.logger).log(`Tab removed: ${e}`),r.remove(e),i.removeTabDetails(e)})),chrome.permissions.onAdded.addListener((async()=>{if(await chrome.permissions.contains(f.optionalPermissions)&&(chrome.webNavigation.onBeforeNavigate.hasListener(S)||chrome.webNavigation?.onBeforeNavigate?.addListener(S),chrome.webNavigation.onCreatedNavigationTarget.hasListener(w)||chrome.webNavigation?.onCreatedNavigationTarget?.addListener(w),chrome.webNavigation.onCompleted.hasListener(C)||chrome.webNavigation?.onCompleted?.addListener(C)),y)await y.enableLibrary();else{const e=await(0,t.useStream)();await e.enableLibrary()}})),chrome.permissions.onRemoved.addListener((async()=>{const e=await(0,t.useStream)();if(!await chrome.permissions.contains(f.requiredPermissions)){const t=e.di().get(l.BgInjection.observer);t?.clear?.([o.InternalMessageBgType.STREAM_ENABLED]),_=!1}})),chrome.runtime.onMessage.addListener(((e,n)=>{(0,t.useStream)().then((t=>{t.di().get(l.BgInjection.inMessageManager).onMessage(e,n)}))})),chrome.alarms.onAlarm.addListener((async({name:e})=>{const n=await(0,t.useStream)(),r=n.di().get(l.BgInjection.couponManager),i=n.di().get(l.BgInjection.trackEventStorage),o={[d.ECommerceStreamAlarms.COUPON_DOMAIN]:r.fetchDomains.bind(r),[d.ECommerceStreamAlarms.PREVENT_DUPLICATION]:i.remove.bind(i),[d.ECommerceStreamAlarms.HEARTBEAT]:b.bind(null,n)}[e];o?.()})),chrome.tabs.onCreated.addListener((async e=>{(await(0,t.useStream)()).di().get(l.BgInjection.webNavigationHandler).onTabCreated(e)}));class M{constructor(e){this.STORAGE_DEFAULT_KEY="E_COMMERCE_STREAM_CONFIG",c.SessionStorageAdapter.adapt(),this.populateConfig(e),this.initContainer(),this.observer=this.container.get(l.BgInjection.observer)}async enableLibrary(){v&&_||(v=!0,await this.initStream(),this.observer.emit(o.InternalMessageBgType.STREAM_ENABLED),this.createHeartBeatAlarm())}async syncUp(){await this.syncUpManager.syncUp()}async getPriceTrend(e){return await this.priceTrendClient.get(e)}async getSavedCoupons(e){return await this.couponManager.getSavedCoupons(e)}async getSavedDeals(e){return await this.couponManager.getSavedDeals(e)}subscribe(e,t){this.observer?.subscribe?.(e,t)}isLibraryEnabled(){return _}tracking(e){this.config.track.tracking=e}setIp(e){this.config.client.ip=e}safePriceCheckTracking(e){null!=this.config.safePriceCheck&&(this.config.safePriceCheck.tracking=e)}di(){return this.container}version(){return"7.0.1"}populateConfig(e){const t={lib:this.version(),extension:e.version.extension};this.config={...e,version:t,storageKey:e.storageKey??this.STORAGE_DEFAULT_KEY}}initContainer(){this.container=new u.BgContainer(this.config),this.container.injectDependencies()}async initStream(){this.initManagers(),await this.initAuthentication(),this.initFeatures(),await this.handleMigrations(),this.initSubscriptions(),await this.detectSyncUp()}initManagers(){this.alarmManager=this.container.get(l.BgInjection.alarmManager),this.inMessageManager=this.container.get(l.BgInjection.inMessageManager),this.authManager=this.container.get(l.BgInjection.authManager),this.configManager=this.container.get(l.BgInjection.configManager),this.trackManager=this.container.get(l.BgInjection.trackManager),this.errorTraceClient=this.container.get(l.BgInjection.errorTraceClient)}async initAuthentication(){null!=this.config.auth&&await this.authManager.setup()}initFeatures(){this.syncUpManager=this.container.get(l.BgInjection.syncUpManager),this.priceTrendClient=this.container.get(l.BgInjection.priceTrendClient),this.safePriceCheckerManager=this.container.get(l.BgInjection.safePriceCheckerManager),this.couponManager=this.container.get(l.BgInjection.couponManager),this.syncUpManager.setup(),this.configManager.setup()}async handleMigrations(){await this.container.get(l.BgInjection.migration_3_0_0).handle(),await this.container.get(l.BgInjection.migration_7_0_0).handle()}initSubscriptions(){this.subscribe(o.InternalMessageBgType.TRACK,this.onTrack.bind(this)),this.subscribe(a.InternalSafePriceCheckerMessages.TRACK,this.onSafeCheck.bind(this)),this.subscribe(s.InternalCouponMessages.TRACK,this.onCouponFetch.bind(this)),this.subscribe(o.InternalMessageBgType.ERROR_TRACE,this.onErrorTrace.bind(this))}async detectSyncUp(){await this.configManager.shouldUpdateConfig()&&this.syncUpManager.syncUp()}onTrack(e){this.trackManager.track(e),this.detectSyncUp()}onSafeCheck(e){this.safePriceCheckerManager.checkPrice(e.payload)}onCouponFetch({url:e}){this.couponManager.fetchCoupons(e)}onErrorTrace({testEvent:e,...t}){this.errorTraceClient.track(t,e)}createHeartBeatAlarm(){this.alarmManager.create(d.ECommerceStreamAlarms.HEARTBEAT,{periodInMinutes:30,delayInMinutes:.01})}}r([(0,h.libEnabled)(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],M.prototype,"enableLibrary",null),r([(0,h.libEnabled)(),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],M.prototype,"syncUp",null),r([(0,h.libEnabled)(),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],M.prototype,"getPriceTrend",null),r([(0,h.libEnabled)(),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],M.prototype,"getSavedCoupons",null),r([(0,h.libEnabled)(),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],M.prototype,"getSavedDeals",null),t.createStream=async e=>{if(await(async()=>{const e="ecommerce-stream-processor",t={id:e,matches:["https://*/*","http://*/*"],js:["libs/processor.js"],runAt:"document_start",allFrames:!0},[n]=await chrome.scripting.getRegisteredContentScripts({ids:[e]});n||await chrome.scripting.registerContentScripts([t])})(),y)throw new Error("Ecommerce library was already initiated");return y=new M(e),y.subscribe(o.InternalMessageBgType.STREAM_ENABLED,(()=>{_=!0,m.forEach((e=>{e(y)}))})),y},t.useStream=async()=>y&&_?y:await new Promise((e=>{m.push(e)}))},3492:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AlarmManager=void 0;const i=n(3580);let o=class{async clear(e){return await chrome.alarms.clear(e)}async create(e,t){await chrome.alarms.get(e)||await chrome.alarms.create(e,t)}};o=r([(0,i.injectable)()],o),t.AlarmManager=o},5920:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=void 0;const a=n(1106),s=n(7729),c=n(3580),u=n(5470);let l=class{constructor(e){this.config=e}async fetch(e,t={},n){const r=await fetch(e,t);return n?r:await r.json()}async fetchSecurityToken(){const{api:e,token:t}=this.config.auth??{};if(!e||!t)throw new Error("Authentication details were not provided");const n=`${e}/auth/access`;return await this.fetch(n,{method:"POST",headers:(0,a.pipe)((0,s.authorizationHeader)(t))({})},!0)}};l=r([(0,c.injectable)(),o(0,(0,c.inject)(u.ConfigInjections.config)),i("design:paramtypes",[Object])],l),t.AuthClient=l},7978:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.AvailableFeatureName=void 0,(n=t.AvailableFeatureName||(t.AvailableFeatureName={})).PRICE_TREND="priceTrend",n.COUPON="coupon"},3351:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthManager=t.AuthError=t.DATE_SHIFT_MS=t.NETWORK_DELAY_S=t.TOKEN_EXPIRATION_THRESHOLD_MS=void 0;const a=n(5920),s=n(1106),c=n(7729),u=n(4182),l=n(3580),h=n(3252);t.TOKEN_EXPIRATION_THRESHOLD_MS=1e3,t.NETWORK_DELAY_S=60,t.DATE_SHIFT_MS=t.TOKEN_EXPIRATION_THRESHOLD_MS*t.NETWORK_DELAY_S;class f extends Error{constructor(e){super(e),this.name="AuthError"}}t.AuthError=f;let d=class{constructor(e,t){this.authClient=e,this.storage=t}async setup(){await this.initAuthData()}async fetch(e,t,n,r={},i){const o=await this.getToken();await this.validateAvailability(e,t);const a={...r,headers:(0,s.pipe)((0,c.authorizationHeader)(o))(r?.headers)};return await this.authClient.fetch(n,a,i)}async validateAvailability(e,t){if("*"!==t&&!await this.storage.checkAvailableFeature(e,t))throw new f(`Feature: "${e}" is not available for domain: "${t}"`)}async initAuthData(){const e=await this.storage.getSecurityToken();(e?.expirationTime??0)+t.DATE_SHIFT_MS<Date.now()&&await this.fetchAuthData()}async getToken(){await this.initAuthData();const e=await this.storage.getSecurityToken();return e?.value}async fetchAuthData(){const e=await this.fetchSecurityToken();await this.storage.storeAuthData(e)}async fetchSecurityToken(){try{const e=await this.authClient.fetchSecurityToken();if(!e.ok){const{message:t}=await e.json();throw new f(t)}return await this.parsedToken(e)}catch(e){if(403===e.status)throw await this.storage.removeTokenEntities(),new f("Token is corrupted. Please contact your administrator to provide another");throw new f(`Could not get a security token, ${e}`)}}async parsedToken(e){const t=await e.json();return this.populateTokenExpiration(e.headers,t)}populateTokenExpiration(e,n){const r=e.get("Date");if(!r)return n;const i=new Date(r).getTime(),o=Math.abs(Date.now()-i);return o<=t.DATE_SHIFT_MS?n:{...n,expirationTime:n.expirationTime+o}}};d=r([(0,l.injectable)(),o(0,(0,l.inject)(h.BgInjection.authClient)),o(1,(0,l.inject)(h.BgInjection.authStorage)),i("design:paramtypes",[a.AuthClient,u.AuthStorage])],d),t.AuthManager=d},7159:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CouponMessages=t.InternalCouponMessages=t.CouponType=void 0,(n=t.CouponType||(t.CouponType={})).coupon="coupons",n.deal="deals",(t.InternalCouponMessages||(t.InternalCouponMessages={})).TRACK="COUPON_TRACK",(t.CouponMessages||(t.CouponMessages={})).COUPON="ECOMMERCE_COUPON"},8417:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CouponClient=t.CouponClientError=void 0;const a=n(3351),s=n(7159),c=n(7978),u=n(3580),l=n(3252),h=n(5470),f=n(3314);class d extends Error{constructor(e){super(e),this.name="CouponClientError"}}t.CouponClientError=d;let g=class{constructor(e,t){this.config=e,this.authManager=t}async fetchDeals(e){const t=this.endpoint(`?domain=${e}`,s.CouponType.deal),n=await this.authManager.fetch(c.AvailableFeatureName.COUPON,e,t,{},!0);return 204===n.status?[]:await n.json()}async fetchCoupons(e){const t=this.endpoint(`?domain=${e}`,s.CouponType.coupon),n=await this.authManager.fetch(c.AvailableFeatureName.COUPON,e,t,{},!0);return 204===n.status?[]:await n.json()}async fetchDomains(){const e=this.endpoint("/domains",s.CouponType.coupon),t=await this.authManager.fetch(c.AvailableFeatureName.COUPON,"*",e,{},!0);return 200!==t.status?[]:await t.json()}endpoint(e,t){if(!this.config.coupon?.api)throw new d("ECommerceStream: Coupon feature is not initialized. Please provide the api url");return`${this.config.coupon?.api}/${t}${e}`}};r([(0,f.withCache)(),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],g.prototype,"fetchDeals",null),r([(0,f.withCache)(),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],g.prototype,"fetchCoupons",null),g=r([(0,u.injectable)(),o(0,(0,u.inject)(h.ConfigInjections.config)),o(1,(0,u.inject)(l.BgInjection.authManager)),i("design:paramtypes",[Object,a.AuthManager])],g),t.CouponClient=g},2554:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CouponManager=void 0;const a=n(8417),s=n(1272),c=n(1468),u=n(7159),l=n(3492),h=n(4343),f=n(3580),d=n(3252),g=n(5470),p=n(1106),y=n(1747);let v=class{constructor(e,t,n,r,i,o){this.config=e,this.client=t,this.observer=n,this.storage=r,this.alarmManager=i,this.logger=o,this.setup()}async fetchDomains(){try{const e=await this.client.fetchDomains();await this.storage.storeDomains(e)}catch(e){this.logger.error("CouponManager: could not fetch coupon domains",e)}}async fetchCoupons(e=""){const t=this.getDomain(e);if(await this.isCouponsAvailable(t))try{const e=[this.client.fetchCoupons(t),this.client.fetchDeals(t)],[n,r]=await Promise.allSettled(e);if("rejected"===n.status&&"rejected"===r.status)return void this.logger.error(`CouponManager: could not fetch coupons for the domain: "${t}"`,n.reason,r.reason);const i=n.value??[],o=r.value??[];if(!i?.length&&!o?.length)return;await this.storage.saveCoupons(i,t),await this.storage.saveDeals(o,t);const a={domain:t,coupons:i,deals:o};this.observer.emit(u.CouponMessages.COUPON,a)}catch(e){this.logger.error(`CouponManager: could not fetch coupons for the domain: "${t}"`,e)}}async getSavedCoupons(e=""){const t=this.getDomain(e);return await this.storage.getCoupons(t)}async getSavedDeals(e=""){const t=this.getDomain(e);return await this.storage.getDeals(t)}async isCouponsAvailable(e){const t=await this.storage.getDomains();return t.some?.((({domain:t})=>(0,p.getRegex)(t).test(e)))}async setup(){null!=this.config.coupon&&(this.setupAlarm(),await this.storage.hasDomains()||await this.fetchDomains())}setupAlarm(){const e=this.config.coupon?.syncUpDomainM??60;this.alarmManager.create(y.ECommerceStreamAlarms.COUPON_DOMAIN,{delayInMinutes:e,periodInMinutes:e})}getDomain(e){try{const{host:t}=new URL(e);return t}catch{return e}}};v=r([(0,f.injectable)(),o(0,(0,f.inject)(g.ConfigInjections.config)),o(1,(0,f.inject)(d.BgInjection.couponClient)),o(2,(0,f.inject)(d.BgInjection.observer)),o(3,(0,f.inject)(d.BgInjection.couponStorage)),o(4,(0,f.inject)(d.BgInjection.alarmManager)),o(5,(0,f.inject)(d.BgInjection.logger)),i("design:paramtypes",[Object,a.CouponClient,s.Observer,h.CouponStorage,l.AlarmManager,c.Logger])],v),t.CouponManager=v},5488:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTraceClient=void 0;const a=n(3580),s=n(5470),c=n(1106),u=n(5158),l=n(3252),h=n(1468),f=n(8357),d=n(1213);let g=class{constructor(e,t,n){this.config=e,this.logger=t,this.webNavigationStorage=n}async track(e,t){const n=t?"/ecommerce/debugerrors":"/ecommerce/errors",r=this.endpoint(n);try{const t=await this.requestInit(e);await fetch(r,t)}catch(e){this.logger.error("ErrorTraceClient: could not send error trace",e.message)}}async requestInit(e){const t=await this.preparedPayload(e),n=(0,f.prepareBody)(t,this.config.compression);return{method:"POST",cache:"no-cache",headers:(0,c.pipe)((0,u.contentTypeHeader)(this.config))({}),body:n}}async preparedPayload({tabId:e,...t}){const n=await this.webNavigationStorage.getTabDetails(e);return{versions:{...this.config.version,template:t.template.version,stakeTrace:this.version()},user:this.config.client,tabId:e,refData:{refTabId:n.refTabId,refUrl:n.refUrl},...t}}endpoint(e){return`${this.config.stackTrace.api}${e}`}version(){return"1.2.1"}};g=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ConfigInjections.config)),o(1,(0,a.inject)(l.BgInjection.logger)),o(2,(0,a.inject)(l.BgInjection.webNavigationStorage)),i("design:paramtypes",[Object,h.Logger,d.WebNavigationStorage])],g),t.ErrorTraceClient=g},9737:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.acceptHeader=void 0;const r=n(5158);t.acceptHeader=({compression:e})=>(t={})=>({...t,Accept:e?r.ContentTypeHeader.OCTET_STREAM:r.ContentTypeHeader.JSON})},7729:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authorizationHeader=void 0,t.authorizationHeader=e=>(t={})=>({...t,Authorization:`Bearer ${e}`})},3653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basicAuthorizationHeader=void 0,t.basicAuthorizationHeader=e=>(t={})=>({...t,Authorization:`Basic ${e}`})},5158:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.contentTypeHeader=t.ContentTypeHeader=void 0,function(e){e.JSON="application/json;charset=utf-8",e.OCTET_STREAM="application/octet-stream"}(n=t.ContentTypeHeader||(t.ContentTypeHeader={})),t.contentTypeHeader=({compression:e})=>(t={})=>({...t,"Content-Type":e?n.OCTET_STREAM:n.JSON})},523:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parseResponse=void 0;const a=n(5158),s=o(n(6961));t.parseResponse=async e=>{const t=e.headers.get("Content-Type");if(a.ContentTypeHeader.JSON.includes(t))return await e.json();if(t===a.ContentTypeHeader.OCTET_STREAM){const t=await e.text();return JSON.parse(s.decompressFromUTF16(t))}throw new Error(`Api response could not be parsed accordingly. Type: "${t}"`)}},8357:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.prepareBody=void 0;const a=o(n(6961));t.prepareBody=(e,t)=>{const n=JSON.stringify(e);return t?a.compressToUTF16(n):n}},3893:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PriceTrendClient=t.PriceTrendClientError=void 0;const a=n(3351),s=n(7978),c=n(3580),u=n(3252),l=n(5470),h=n(3314);class f extends Error{constructor(e){super(e),this.name="PriceTrendClientError"}}t.PriceTrendClientError=f;let d=class{constructor(e,t){this.config=e,this.authManager=t}async get(e){const t=this.endpoint(e);return await this.authManager.fetch(s.AvailableFeatureName.PRICE_TREND,e.domain,t)}endpoint(e){if(!this.config.priceTrend?.api)throw new f("ECommerceStream: Price trend is not initialized. Please provide the api url");return`${this.config.priceTrend?.api}/price/trend?${this.query(e)}`}query({productId:e,domain:t,days:n}){const r=new URLSearchParams;return r.set("productId",e),r.set("domain",t),r.set("days",`${n}`),r.toString()}};r([(0,h.withCache)(),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],d.prototype,"get",null),d=r([(0,c.injectable)(),o(0,(0,c.inject)(l.ConfigInjections.config)),o(1,(0,c.inject)(u.BgInjection.authManager)),i("design:paramtypes",[Object,a.AuthManager])],d),t.PriceTrendClient=d},564:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalSafePriceCheckerMessages=t.SafePriceCheckerMessages=void 0,(t.SafePriceCheckerMessages||(t.SafePriceCheckerMessages={})).SAFE_CHECK="ECOMMERCE_SAFE_CHECK",(t.InternalSafePriceCheckerMessages||(t.InternalSafePriceCheckerMessages={})).TRACK="SAFE_PRICE_TRACK"},7473:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SafePriceCheckerClient=t.SafePriceCheckerClientError=void 0;const a=n(1106),s=n(5158),c=n(3580),u=n(5470),l=n(523),h=n(8357);class f extends Error{constructor(e){super(e),this.name="SafePriceCheckerClientError"}}t.SafePriceCheckerClientError=f;let d=class{constructor(e){this.config=e}async checkPrice(e){const t=this.endpoint("/ecommerce/verify"),n=await fetch(t,this.requestInit(e));return await(0,l.parseResponse)(n)}requestInit(e){const t=(0,h.prepareBody)(e,this.config.compression);return{method:"POST",cache:"no-cache",headers:(0,a.pipe)((0,s.contentTypeHeader)(this.config))({}),body:t}}endpoint(e){if(!this.config.safePriceCheck?.api)throw new f("ECommerceStream: Safe price checker is not initialized. Please provide the api url");return`${this.config.safePriceCheck?.api}${e}`}};d=r([(0,c.injectable)(),o(0,(0,c.inject)(u.ConfigInjections.config)),i("design:paramtypes",[Object])],d),t.SafePriceCheckerClient=d},2381:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SafePriceCheckerManager=void 0;const a=n(1468),s=n(1272),c=n(564),u=n(7473),l=n(3580),h=n(3252),f=n(5470);let d=class{constructor(e,t,n,r){this.config=e,this.logger=t,this.observer=n,this.client=r}async checkPrice({data:e}){if(!this.config.safePriceCheck?.tracking)return;const t={clientDef:this.config.client,productsInCart:e};try{const e=await this.client.checkPrice(t);this.observer.emit(c.SafePriceCheckerMessages.SAFE_CHECK,e)}catch(e){this.logger.error("SafePriceCheckerManager: Error while checking price",e)}}};d=r([(0,l.injectable)(),o(0,(0,l.inject)(f.ConfigInjections.config)),o(1,(0,l.inject)(h.BgInjection.logger)),o(2,(0,l.inject)(h.BgInjection.observer)),o(3,(0,l.inject)(h.BgInjection.safePriceCheckerClient)),i("design:paramtypes",[Object,a.Logger,s.Observer,u.SafePriceCheckerClient])],d),t.SafePriceCheckerManager=d},4468:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncUpClient=void 0;const a=n(1106),s=n(9737),c=n(3653),u=n(3580),l=n(5470),h=n(523);let f=class{constructor(e){this.config=e}async getConfig(){const e=this.endpoint(),t=await fetch(e,{headers:(0,a.pipe)((0,s.acceptHeader)(this.config),(0,c.basicAuthorizationHeader)(this.config.syncUp.token))({})});return await(0,h.parseResponse)(t)}endpoint(){return`${this.config.syncUp.api}/ecommerce/template/config?${this.query()}`}query(){const e=new URLSearchParams;return e.set("libVersion",this.config.version.lib),e.set("partnerId",`${this.config.client.partnerId}`),e.toString()}};f=r([(0,u.injectable)(),o(0,(0,u.inject)(l.ConfigInjections.config)),i("design:paramtypes",[Object])],f),t.SyncUpClient=f},3367:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncUpManager=void 0;const a=n(4468),s=n(1468),c=n(7438),u=n(1106),l=n(3580),h=n(3252),f=n(5470),d=n(4054),g=n(4268);let p=class{constructor(e,t,n,r,i){this.logger=e,this.client=t,this.config=n,this.configManager=r,this.meta=i,this.syncUp=(0,u.debounce)((async()=>{try{const e=await this.client.getConfig();if(!e?.length)return this.sendMeta({result:!1,failReason:"Config is empty"}),void this.logger.log("SyncUpManager: Config is empty");const t=Date.now(),n=await this.configManager.updateConfig(e,t);this.sendMeta({result:n,...!n&&{failReason:"Config was not stored due to storage limit exceeded"}})}catch(e){this.sendMeta({result:!1,failReason:e.message??e}),this.logger.error("SyncUpManager: Could not sync up configuration",e)}}))}setup(){this.config.syncUp.immediate&&this.syncUp()}sendMeta(e){const t={type:g.EcommerceMetaInfoEvents.syncUp,details:e};this.meta.send(t)}};p=r([(0,l.injectable)(),o(0,(0,l.inject)(h.BgInjection.logger)),o(1,(0,l.inject)(h.BgInjection.syncUpClient)),o(2,(0,l.inject)(f.ConfigInjections.config)),o(3,(0,l.inject)(h.BgInjection.configManager)),o(4,(0,l.inject)(h.BgInjection.metaInfoManager)),i("design:paramtypes",[s.Logger,a.SyncUpClient,Object,c.ConfigManager,d.MetaInfoManager])],p),t.SyncUpManager=p},3975:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackClient=void 0;const a=n(1106),s=n(5158),c=n(3580),u=n(5470),l=n(8357);let h=class{constructor(e){this.config=e}async track(e,t=!1){const n=t?"/ecommerce/debugdata":"/ecommerce/data",r=this.endpoint(n);await fetch(r,this.requestInit(e))}requestInit(e){const t=(0,l.prepareBody)(e,this.config.compression);return{method:"POST",cache:"no-cache",headers:(0,a.pipe)((0,s.contentTypeHeader)(this.config))({}),body:t}}endpoint(e){return`${this.config.track.api}${e}`}};h=r([(0,c.injectable)(),o(0,(0,c.inject)(u.ConfigInjections.config)),i("design:paramtypes",[Object])],h),t.TrackClient=h},9210:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackManager=void 0;const a=n(3580),s=n(5470),c=n(3252),u=n(1213),l=n(696),h=n(1468),f=n(3492),d=n(3975),g=n(1747);let p=class{constructor(e,t,n,r,i,o){this.config=e,this.webNavigationStorage=t,this.trackEventStorage=n,this.logger=r,this.alarmManager=i,this.client=o}async track({payload:e,tabId:t}){const{templateVersion:n,preventDuplicates:r,testEvent:i=!1,...o}=e;if(!this.config.track.tracking)return;const a=await this.webNavigationStorage.getTabDetails(t),s={version:{...this.config.version,template:n},tabId:t,refUrl:a.refUrl,refTabId:a.refTabId,clientDef:this.config.client,...o};if(r?.timeMin){if(await this.trackEventStorage.isEqual(s,r.fields))return void this.logger.log(`Event "${o.event}" was prevented due to duplications occurred`);this.trackEventStorage.store(s),this.alarmManager.create(g.ECommerceStreamAlarms.PREVENT_DUPLICATION,{delayInMinutes:r?.timeMin})}await this.client.track(s,i)}};p=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ConfigInjections.config)),o(1,(0,a.inject)(c.BgInjection.webNavigationStorage)),o(2,(0,a.inject)(c.BgInjection.trackEventStorage)),o(3,(0,a.inject)(c.BgInjection.logger)),o(4,(0,a.inject)(c.BgInjection.alarmManager)),o(5,(0,a.inject)(c.BgInjection.trackClient)),i("design:paramtypes",[Object,u.WebNavigationStorage,l.TrackEventStorage,h.Logger,f.AlarmManager,d.TrackClient])],p),t.TrackManager=p},7438:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigManager=void 0;const a=n(3763),s=n(1468),c=n(3580),u=n(3252),l=n(5470);let h=class{constructor(e,t,n){this.logger=e,this.config=t,this.storage=n}async setup(){const e=this.getLocalWatchers();if(e.length)return this.logger.log("ConfigManager: save initial config"),void await this.storage.saveConfig(e);const t=await this.storage.getConfig();this.replaceLocalWatchers(t)}async updateConfig(e,t){const n=await this.storage.saveConfig(e);return n?await this.storage.saveSyncTime(t):await this.storage.removeSyncTime(),this.replaceLocalWatchers(e),n}async shouldUpdateConfig(){return await this.storage.shouldSyncConfig()}getLocalWatchers(){return this.config.watchers}replaceLocalWatchers(e){this.config.watchers=e,this.logger.log("ConfigManager: config is updated")}};h=r([(0,c.injectable)(),o(0,(0,c.inject)(u.BgInjection.logger)),o(1,(0,c.inject)(l.ConfigInjections.config)),o(2,(0,c.inject)(u.BgInjection.configStorage)),i("design:paramtypes",[s.Logger,Object,a.ConfigStorage])],h),t.ConfigManager=h},3314:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkStorageArea=t.libEnabled=t.withCache=void 0;const r=n(8826);t.withCache=function(){return function(e,t,n){const r=n.value;n.value=async function(...n){const i=`${t}-${JSON.stringify(n)}`;if(i in(e.__cache__??{}))return e.__cache__?.[i];const o=await r.apply(this,n);return e.__cache__={...e.__cache__,[i]:o},o}}},t.libEnabled=function(){return function(e,t,n){const i=n.value;n.value=async function(...e){if(await chrome.permissions.contains(r.requiredPermissions))return i.apply(this,e);throw new Error("Library permissions were not granted")}}},t.checkStorageArea=function(){return function(e,t,n){const r=n.value;n.value=async function(...e){const t=e.at(0);if(!chrome.storage[t])throw new Error(`Storage type "${t}" is not presentable`);return r.apply(this,e)}}}},4939:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BgContainer=void 0;const r=n(3580),i=n(3252),o=n(6044),a=n(514),s=n(1272),c=n(1468),u=n(3975),l=n(9210),h=n(2381),f=n(7473),d=n(3367),g=n(7438),p=n(4468),y=n(3763),v=n(5920),_=n(3351),m=n(4182),b=n(2554),w=n(4343),S=n(8417),C=n(3893),M=n(7090),E=n(3492),j=n(3794),A=n(5470),T=n(5488),I=n(58),O=n(1213),R=n(696),P=n(9393),k=n(2300),N=n(4054);t.BgContainer=class{constructor(e){this.config=e,this.dependenciesInjected=!1,this.container=new r.Container}get(e){return this.container.get(e)}injectDependencies(){if(this.dependenciesInjected)throw new Error("EcommerceStream: dependencies were already injected");this.dependenciesInjected=!0;const e={[i.BgInjection.outMessageManager]:o.OutBgMessageManager,[i.BgInjection.inMessageManager]:a.InBgMessageManager,[i.BgInjection.observer]:s.Observer,[i.BgInjection.logger]:c.Logger,[i.BgInjection.trackClient]:u.TrackClient,[i.BgInjection.trackManager]:l.TrackManager,[i.BgInjection.safePriceCheckerManager]:h.SafePriceCheckerManager,[i.BgInjection.safePriceCheckerClient]:f.SafePriceCheckerClient,[i.BgInjection.syncUpManager]:d.SyncUpManager,[i.BgInjection.syncUpClient]:p.SyncUpClient,[i.BgInjection.configManager]:g.ConfigManager,[i.BgInjection.configStorage]:y.ConfigStorage,[i.BgInjection.authManager]:_.AuthManager,[i.BgInjection.authClient]:v.AuthClient,[i.BgInjection.authStorage]:m.AuthStorage,[i.BgInjection.couponManager]:b.CouponManager,[i.BgInjection.couponClient]:S.CouponClient,[i.BgInjection.couponStorage]:w.CouponStorage,[i.BgInjection.priceTrendClient]:C.PriceTrendClient,[i.BgInjection.runtimeStorage]:M.RuntimeStorage,[i.BgInjection.alarmManager]:E.AlarmManager,[i.BgInjection.migration_3_0_0]:j.Migration_3_0_0,[i.BgInjection.migration_7_0_0]:P.Migration_7_0_0,[i.BgInjection.errorTraceClient]:T.ErrorTraceClient,[i.BgInjection.webNavigationHandler]:I.WebNavigationHandler,[i.BgInjection.webNavigationStorage]:O.WebNavigationStorage,[i.BgInjection.trackEventStorage]:R.TrackEventStorage,[i.BgInjection.storageAccessor]:k.StorageAccessor,[i.BgInjection.metaInfoManager]:N.MetaInfoManager};return Object.entries(e).forEach((([e,t])=>{this.bind(e,t)})),this.bindConstant(A.ConfigInjections.config,this.config),this.container}bind(e,t){return this.container.bind(e).to(t).inSingletonScope(),this.container}bindConstant(e,t){return this.container.bind(e).toConstantValue(t),this.container}}},3252:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.BgInjection=void 0,(n=t.BgInjection||(t.BgInjection={})).outMessageManager="outMessageManager",n.inMessageManager="inMessageManager",n.observer="observer",n.logger="logger",n.trackClient="trackClient",n.trackManager="trackManager",n.safePriceCheckerManager="safePriceCheckerManager",n.safePriceCheckerClient="safePriceCheckerClient",n.syncUpManager="syncUpManager",n.syncUpClient="syncUpClient",n.configManager="configManager",n.configStorage="configStorage",n.authManager="authManager",n.authClient="authClient",n.authStorage="authStorage",n.couponManager="couponManager",n.couponClient="couponClient",n.couponStorage="couponStorage",n.priceTrendClient="priceTrendClient",n.runtimeStorage="runtimeStorage",n.alarmManager="alarmManager",n.migration_3_0_0="migration_3_0_0",n.migration_7_0_0="migration_7_0_0",n.errorTraceClient="errorTraceClient",n.webNavigationHandler="webNavigationHandler",n.webNavigationStorage="webNavigationStorage",n.trackEventStorage="trackEventStorage",n.storageAccessor="storageAccessor",n.metaInfoManager="metaInfoManager"},514:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InBgMessageManager=void 0;const a=n(6444),s=n(6044),c=n(1272),u=n(1468),l=n(7090),h=n(2327),f=n(7159),d=n(3580),g=n(3252),p=n(5470),y=n(4940),v=n(1106),_=(e,t)=>`${e}-${t}`;let m=class{constructor(e,t,n,r,i){this.logger=e,this.observer=t,this.out=n,this.config=r,this.runtimeStorage=i,this.prerenderTabs=new Map,this.observer.subscribe(h.InternalMessageBgType.INIT_COMPLETED,this.onInitCompleted.bind(this))}onMessage(e,t){const n={[a.MessageContentType.ECOMMERCE_INIT]:this.onInit.bind(this),[a.MessageContentType.ECOMMERCE_TRACK]:this.onTrack.bind(this),[a.MessageContentType.ECOMMERCE_RUNTIME_STORAGE_SAVE]:this.onRuntimeStorageSave.bind(this),[a.MessageContentType.ECOMMERCE_RUNTIME_STORAGE_REMOVE]:this.onRuntimeStorageRemove.bind(this),[a.MessageContentType.ERROR_TRACE]:this.onErrorTrace.bind(this),[a.MessageContentType.ECOMMERCE_RE_INIT]:this.onReInit.bind(this),[a.MessageContentType.ECOMMERCE_INIT_SHOPIFY]:this.onInit.bind(this)};n[e.type]?n[e.type](e,t):this.logger.log("Ignored message",e)}onInit(e,t){if("prerender"===t.documentLifecycle){const n=_(t.documentId,t.tab?.id);return void this.prerenderTabs.set(n,{sender:t,message:e})}const n=t.tab?.id;this.runtimeStorage.has(n)&&!t.frameId&&this.runtimeStorage.remove(n),this.prepareWatchers(e,t),this.prepareCoupons(e,Boolean(t.frameId))}onReInit({payload:e,id:t},n){const r=n.tab?.id;this.sendInitMessage({id:t,url:e.url,$shopify:e[y.RESERVED_VARIABLES.$shopify],tabId:r,initial:!1,tabUrl:n.tab?.url})}onTrack(e,t){this.logger.log(JSON.stringify(e,null,2));const n={tabId:t.tab?.id,payload:e.payload};e.customEvent||this.observer.emit(h.InternalMessageBgType.TRACK,n),this.observer.emit(e.payload.event,n)}onRuntimeStorageSave({payload:e},t){const n=t.tab?.id,{data:r,name:i}=e;this.runtimeStorage.append(n,i,r)}onRuntimeStorageRemove({payload:e},t){const n=t.tab?.id;this.runtimeStorage.append(n,e.name,null)}onErrorTrace({payload:e,testEvent:t},n){this.observer.emit(h.InternalMessageBgType.ERROR_TRACE,{...e,tabId:n.tab?.id,testEvent:t})}prepareCoupons({payload:e},t){t||this.observer.emit(f.InternalCouponMessages.TRACK,e)}prepareWatchers({payload:e,id:t},n){const r=n.tab?.id;this.sendInitMessage({id:t,url:e.url,tabId:r,initial:!0,$shopify:y.RESERVED_VARIABLES.$shopify in e?e[y.RESERVED_VARIABLES.$shopify]:null,tabUrl:n.tab?.url}),n.frameId&&this.out.sendIframeLoadedMessage(r,t,e.url)}sendInitMessage({id:e,url:t,$shopify:n=null,initial:r,tabId:i,tabUrl:o}){const a=o===t?t:o,s=n?"shopify":a,c=this.config.watchers?.find?.(this.urlRegexPredicate(s));if(null==c)return;const u=c.config.find(this.urlRegexPredicate(a));if(!u)return;const l={...this.runtimeStorage.get(i),...Boolean(n)&&{[y.RESERVED_VARIABLES.$shopify]:n}};(r?this.out.sendInitMessage:this.out.sendReInitMessage).call(this.out,i,u,l,t,c,e)}urlRegexPredicate(e){return({regex:t})=>(0,v.getRegex)(t).test(e)}onInitCompleted(e){const t=_(e.documentId,e.tabId),n=!this.prerenderTabs.has(t),r="outermost_frame"!==e.frameType;if(n||r)return;const{message:i,sender:o}=this.prerenderTabs.get(t);this.onInit(i,{...o,tab:{...o.tab,url:e.url},documentLifecycle:e.documentLifecycle,frameId:e.frameId}),this.prerenderTabs.delete(t)}};m=r([(0,d.injectable)(),o(0,(0,d.inject)(g.BgInjection.logger)),o(1,(0,d.inject)(g.BgInjection.observer)),o(2,(0,d.inject)(g.BgInjection.outMessageManager)),o(3,(0,d.inject)(p.ConfigInjections.config)),o(4,(0,d.inject)(g.BgInjection.runtimeStorage)),i("design:paramtypes",[u.Logger,c.Observer,s.OutBgMessageManager,Object,l.RuntimeStorage])],m),t.InBgMessageManager=m},6044:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OutBgMessageManager=void 0;const a=n(2327),s=n(3580),c=n(5470),u=n(3252),l=n(1468);let h=class{constructor(e,t){this.config=e,this.logger=t}sendInitMessage(e,t,n,r,{shared:i,config:o,...s},c){const u={id:c,type:a.MessageBgType.INIT,payload:{watcher:this.populateConfig(t,i),varScope:this.populateScope(n,i),libConfig:{initialUrl:r,logging:Boolean(this.config.logging),marketplace:s}}};this.sendMessage(e,u)}sendReInitMessage(e,t,n,r,{shared:i},o){const s={id:o,type:a.MessageBgType.RE_INIT,payload:{watcher:this.populateConfig(t,i),varScope:this.populateScope(n,i),initialUrl:r}};this.sendMessage(e,s)}sendIframeLoadedMessage(e,t,n){const r={id:t,type:a.MessageBgType.IFRAME_LOADED,payload:{url:n}};this.sendMessage(e,r)}sendMessage(e,t){chrome.tabs.sendMessage(e,t).catch((n=>{this.logger.error(n,"TabId:",e,"Message:",t)}))}populateScope(e,t){return{...t?.vars,...e}}populateConfig(e,{config:t={}}={}){const{func:n,...r}=t,{func:i,...o}=e.config,a=Object.entries(r).reduce(((e,[t,n])=>({...e,[t]:[...n,...e[t]??[]]})),o),s={...n,...i};return{...e,config:{...a,func:s}}}};h=r([(0,s.injectable)(),o(0,(0,s.inject)(c.ConfigInjections.config)),o(1,(0,s.inject)(u.BgInjection.logger)),i("design:paramtypes",[Object,l.Logger])],h),t.OutBgMessageManager=h},2327:(e,t)=>{"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.InternalMessageBgType=t.MessageBgType=void 0,(r=t.MessageBgType||(t.MessageBgType={})).INIT="INIT",r.RE_INIT="RE_INIT",r.IFRAME_LOADED="IFRAME_LOADED",(n=t.InternalMessageBgType||(t.InternalMessageBgType={})).TRACK="__ECOMMERCE_INTERNAL_TRACK__",n.INIT_COMPLETED="__ECOMMERCE_INTERNAL_INIT_COMPLETED__",n.ERROR_TRACE="__ECOMMERCE_ERROR_TRACE__",n.STREAM_ENABLED="__ECOMMERCE_STREAM_ENABLED__"},4268:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EcommerceMetaInfoEvents=void 0,(n=t.EcommerceMetaInfoEvents||(t.EcommerceMetaInfoEvents={})).syncUp="ECOMMERCE_SYNC_UP",n.heartBeat="ECOMMERCE_HEART_BEAT"},1045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetaInfoMessages=void 0,(t.MetaInfoMessages||(t.MetaInfoMessages={})).INFO="ECOMMERCE_META_INFO"},4054:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaInfoManager=void 0;const a=n(3580),s=n(3252),c=n(1272),u=n(1045);let l=class{constructor(e){this.observer=e}send(e){this.observer.emit(u.MetaInfoMessages.INFO,e)}};l=r([(0,a.injectable)(),o(0,(0,a.inject)(s.BgInjection.observer)),i("design:paramtypes",[c.Observer])],l),t.MetaInfoManager=l},4182:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthStorage=void 0;const a=n(3580),s=n(1106),c=n(3252),u=n(2300),l="E_COMMERCE_SECURITY_TOKEN",h="E_COMMERCE_AVAILABLE_FEATURES";let f=class{constructor(e){this.storage=e}async getSecurityToken(){return await this.storage.read("local",l,{asJSON:!0})}async storeAuthData({features:e,...t}){await this.storeSecurityToken(t),await this.storeAvailableFeatures(e)}async checkAvailableFeature(e,t){if(!await this.storage.has("local",h))return!1;const n=(await this.storage.read("local",h,{asJSON:!0,default:[]})).find((({name:t})=>e===t));return null!=n&&n.details.some((e=>(0,s.getRegex)(e).test(t)))}async removeTokenEntities(){await this.storage.remove("local",l),await this.storage.remove("local",h)}async storeAvailableFeatures(e){await this.storage.write("local",h,e,{asJSON:!0})}async storeSecurityToken(e){await this.storage.write("local",l,e,{asJSON:!0})}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(c.BgInjection.storageAccessor)),i("design:paramtypes",[u.StorageAccessor])],f),t.AuthStorage=f},3763:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigStorage=void 0;const a=n(3580),s=n(5470),c=n(3252),u=n(2300),l="E_COMMERCE_STREAM_CONFIG_LAST_SYNC";let h=class{constructor(e,t){this.config=e,this.storage=t}async shouldSyncConfig(){return!await this.storage.has("local",l)||await this.storage.read("local",l)+60*this.config.syncUp.delayInMinutes*1e3<Date.now()}async saveSyncTime(e){await this.storage.write("local",l,e)}async removeSyncTime(){await this.storage.remove("local",l)}async hasStoredConfig(){return await this.storage.has("local",this.config.storageKey)}async saveConfig(e){return await this.storage.write("local",this.config.storageKey,e,{asJSON:!0})}async getConfig(){return await this.storage.read("local",this.config.storageKey,{asJSON:!0,default:[]})}};h=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ConfigInjections.config)),o(1,(0,a.inject)(c.BgInjection.storageAccessor)),i("design:paramtypes",[Object,u.StorageAccessor])],h),t.ConfigStorage=h},4343:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CouponStorage=void 0;const a=n(3580),s=n(3252),c=n(2300),u="E_COMMERCE_COUPON_DOMAINS",l="E_COMMERCE_COUPONS",h="E_COMMERCE_DEALS";let f=class{constructor(e){this.storage=e}async storeDomains(e){await this.storage.write("local",u,e,{asJSON:!0})}async getDomains(){return await this.storage.read("local",u,{asJSON:!0,default:[]})}async hasDomains(){return Boolean((await this.getDomains()).length)}async saveCoupons(e,t){await this.saveEntity(l,e,t)}async saveDeals(e,t){await this.saveEntity(h,e,t)}async getCoupons(e){return await this.getEntity(l,e)}async getDeals(e){return await this.getEntity(h,e)}async saveEntity(e,t,n){const r=await this.storage.read("session",e,{asJSON:!0,default:{}});await this.storage.write("session",e,{...r,[n]:t},{asJSON:!0})}async getEntity(e,t){return await this.storage.has("session",e)?(await this.storage.read("session",e,{asJSON:!0}))[t]??[]:[]}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(s.BgInjection.storageAccessor)),i("design:paramtypes",[c.StorageAccessor])],f),t.CouponStorage=f},7090:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RuntimeStorage=void 0;const a=n(1468),s=n(3580),c=n(3252);let u=class{constructor(e){this.logger=e,this.tabs={}}has(e){const t=this.key(e);return Boolean(this.tabs[t])}create(e){this.logger.log(`Runtime storage: create ${e}`);const t=this.key(e);this.tabs[t]={}}remove(e){const t=this.key(e);delete this.tabs[t]}append(e,t,n){this.has(e)||this.create(e);const r=this.key(e);this.tabs[r][t]=n}get(e){const t=this.key(e);return this.tabs[t]??{}}key(e){return`_${e}`}};u=r([(0,s.injectable)(),o(0,(0,s.inject)(c.BgInjection.logger)),i("design:paramtypes",[a.Logger])],u),t.RuntimeStorage=u},2300:function(e,t,n){"use strict";var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageAccessor=void 0;const l=n(3580),h=n(3252),f=n(1468),d=s(n(6961)),g=n(3314);let p=class{constructor(e){this.logger=e,this.local=new Map,this.session=new Map}async has(e,t){return!!this[e].has(t)||null!=(await chrome.storage[e].get(t))[t]}async remove(e,t){this[e].delete(t),await chrome.storage[e].remove(t)}async write(e,t,n,{compress:r=!1,asJSON:i=!1}={compress:!1,asJSON:!1}){const o=i?JSON.stringify(n):n,a=r?d.compressToUTF16(o):o;try{return await chrome.storage[e].set({[t]:a}),this[e].set(t,a),!0}catch(n){return this[e].set(t,a),this.logger.error(`Could not setup "${t}" to "${e}" storage:`,n),!1}}async read(e,t,{asJSON:n=!1,compress:r=!1,default:i}={compress:!1,asJSON:!1}){if(this[e].has(t)){const i=this[e].get(t);return this.getParsedData(i,r,n)}const o=(await chrome.storage[e].get(t))[t];return o?this.getParsedData(o,r,n):i??null}getParsedData(e,t=!1,n=!1){try{let r=e;return t&&(r=d.decompressFromUTF16(r)),n&&(r=JSON.parse(r)),r}catch{return e}}};a([(0,g.checkStorageArea)(),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],p.prototype,"has",null),a([(0,g.checkStorageArea)(),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],p.prototype,"remove",null),a([(0,g.checkStorageArea)(),c("design:type",Function),c("design:paramtypes",[String,String,"function"==typeof(r="undefined"!=typeof T&&T)?r:Object,Object]),c("design:returntype",Promise)],p.prototype,"write",null),a([(0,g.checkStorageArea)(),c("design:type",Function),c("design:paramtypes",[String,String,Object]),c("design:returntype",Promise)],p.prototype,"read",null),p=a([(0,l.injectable)(),u(0,(0,l.inject)(h.BgInjection.logger)),c("design:paramtypes",[f.Logger])],p),t.StorageAccessor=p},696:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackEventStorage=void 0;const a=n(3580),s=n(3252),c=n(2300),u="ECOMMERCE_LAST_TRACK_EVENT";let l=class{constructor(e){this.storage=e}async isEqual(e,t=["clientTs"]){if(!await this.storage.has("session",u))return!1;try{const n=await this.storage.read("session",u,{asJSON:!0}),r=Object.entries(e).reduce(((e,[n,r])=>({...e,...!t.includes(n)&&{[n]:r}})),{}),i=Object.entries(n).reduce(((e,[n,r])=>({...e,...!t.includes(n)&&{[n]:r}})),{});return JSON.stringify(r)===JSON.stringify(i)}catch{return!1}}async store(e){await this.storage.write("session",u,e,{asJSON:!0})}async remove(){await this.storage.remove("session",u)}};l=r([(0,a.injectable)(),o(0,(0,a.inject)(s.BgInjection.storageAccessor)),i("design:paramtypes",[c.StorageAccessor])],l),t.TrackEventStorage=l},1213:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebNavigationStorage=void 0;const a=n(3580),s=n(5470),c=n(3252),u=n(1468),l=n(2300),h=e=>`ECOMMERCE_TAB_${e}`;let f=class{constructor(e,t,n){this.config=e,this.logger=t,this.storage=n}async getTabDetails(e){try{return await this.storage.read("session",h(e),{compress:this.config.compression,asJSON:!0,default:this.defaultTabDetails(e)})}catch(t){return this.logger.error("WebNavigationStorage",t),this.defaultTabDetails(e)}}async hasTabDetails(e){return await this.storage.has("session",h(e))}async removeTabDetails(e){await this.storage.remove("session",h(e))}async saveTabDetails(e){await this.storage.write("session",h(e.tabId),e,{compress:this.config.compression,asJSON:!0})}defaultTabDetails(e){return{tabId:e,refUrl:"",currentUrl:"",refTabId:null}}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ConfigInjections.config)),o(1,(0,a.inject)(c.BgInjection.logger)),o(2,(0,a.inject)(c.BgInjection.storageAccessor)),i("design:paramtypes",[Object,u.Logger,l.StorageAccessor])],f),t.WebNavigationStorage=f},3794:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Migration_3_0_0=void 0;const a=n(3763),s=n(3367),c=n(1468),u=n(3580),l=n(3252),h=n(2300);let f=class{constructor(e,t,n,r){this.logger=e,this.configStorage=t,this.syncUpManager=n,this.storage=r,this.key="E_COMMERCE_MIGRATION_3_0_0"}async handle(){await this.migrationHandled()||(this.logger.log("Migration_3_0_0: started"),await this.configStorage.hasStoredConfig()&&await this.syncUpManager.syncUp(),await this.confirmMigration())}async migrationHandled(){return await this.storage.has("local",this.key)}async confirmMigration(){await this.storage.write("local",this.key,!0),this.logger.log("Migration_3_0_0: finished")}};f=r([(0,u.injectable)(),o(0,(0,u.inject)(l.BgInjection.logger)),o(1,(0,u.inject)(l.BgInjection.configStorage)),o(2,(0,u.inject)(l.BgInjection.syncUpManager)),o(3,(0,u.inject)(l.BgInjection.storageAccessor)),i("design:paramtypes",[c.Logger,a.ConfigStorage,s.SyncUpManager,h.StorageAccessor])],f),t.Migration_3_0_0=f},9393:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Migration_7_0_0=void 0;const a=n(3367),s=n(1468),c=n(3580),u=n(3252),l=n(3492),h=n(2300);let f=class{constructor(e,t,n,r){this.logger=e,this.syncUpManager=t,this.alarm=n,this.storage=r,this.key="E_COMMERCE_MIGRATION_7_0_0"}async handle(){await this.migrationHandled()||(this.logger.log("Migration_7_0_0: started"),await this.alarm.clear("E_COMMERCE_STREAM_SYNC_UP_ALARM"),await this.syncUpManager.syncUp(),await this.confirmMigration())}async migrationHandled(){return await this.storage.has("local",this.key)}async confirmMigration(){await this.storage.write("local",this.key,!0),this.logger.log("Migration_7_0_0: finished")}};f=r([(0,c.injectable)(),o(0,(0,c.inject)(u.BgInjection.logger)),o(1,(0,c.inject)(u.BgInjection.syncUpManager)),o(2,(0,c.inject)(u.BgInjection.alarmManager)),o(3,(0,c.inject)(u.BgInjection.storageAccessor)),i("design:paramtypes",[s.Logger,a.SyncUpManager,l.AlarmManager,h.StorageAccessor])],f),t.Migration_7_0_0=f},58:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebNavigationHandler=void 0;const a=n(3580),s=n(1106),c=n(3252),u=n(1468),l=n(1213);let h=class{constructor(e,t){this.logger=e,this.storage=t,this.webNavigationQueue=(0,s.queue)()}async onTabCreated({id:e,openerTabId:t,url:n,pendingUrl:r}){await this.webNavigationQueue(this.tabAddedCallback.bind(this,"onTabCreated",e,n??r,t))}async onCreatedNavigationTarget({tabId:e,sourceTabId:t,url:n}){await this.webNavigationQueue(this.tabAddedCallback.bind(this,"onCreatedNavigationTarget",e,n,t))}async onBeforeNavigate({tabId:e,frameId:t,url:n,documentLifecycle:r}){0!==t||"string"==typeof r&&"active"!==r||await this.webNavigationQueue((async()=>{if(!await this.storage.hasTabDetails(e))return void await this.storage.saveTabDetails({tabId:e,currentUrl:n,refTabId:null,refUrl:""});const t=await this.storage.getTabDetails(e);n!==t?.currentUrl?await this.storage.saveTabDetails({tabId:e,currentUrl:n,refTabId:t.tabId,refUrl:t.currentUrl}):this.logger.log("WebNavigationHandler.onBeforeNavigate: Skipped update due to same url")}))}async onCompleted({tabId:e,frameId:t,documentLifecycle:n,url:r}){0!==t||"string"==typeof n&&"active"!==n||await this.webNavigationQueue((async()=>{if(!await this.storage.hasTabDetails(e))return void this.logger.log("WebNavigationHandler.onCompleted: Skipped update due to tab details missing");const t=await this.storage.getTabDetails(e);this.checkUrlMatches(r,t?.currentUrl)?this.logger.log("WebNavigationHandler.onCompleted: Skipped update due to same url"):await this.storage.saveTabDetails({...t,tabId:e,currentUrl:r})}))}async tabAddedCallback(e,t,n,r){if(!t||!r)return;if(await this.storage.hasTabDetails(t)){const e=await this.storage.getTabDetails(t);return void await this.storage.saveTabDetails({...e,refUrl:await this.getUrl(r,e.refUrl),refTabId:r||null})}const i=n??await this.getUrl(t,"");i?await this.storage.saveTabDetails({tabId:t,refUrl:await this.getUrl(r,""),refTabId:r??null,currentUrl:i}):this.logger.log(`WebNavigationHandler.${e}: Skipped creating due to missing url`)}async getUrl(e,t){return e?(await chrome.tabs.get(e))?.url??t:t}checkUrlMatches(e,t){try{const n=new URL(e),r=new URL(t);return n.origin===r.origin&&n.pathname===r.pathname}catch{return e===t}}};h=r([(0,a.injectable)(),o(0,(0,a.inject)(c.BgInjection.logger)),o(1,(0,a.inject)(c.BgInjection.webNavigationStorage)),i("design:paramtypes",[u.Logger,l.WebNavigationStorage])],h),t.WebNavigationHandler=h},1468:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const a=n(3580),s=n(5470);let c=class{constructor(e){this.config=e,this.loggerLabel="%c[ECOMMERCE]",this.loggerLabelStyle="background-color: lightgreen; font-weight: bold; padding: 2px;"}log(e,...t){this.config.logging&&console.log(this.loggerLabel,this.loggerLabelStyle,e,...t)}error(e,...t){this.config.logging&&console.error(this.loggerLabel,this.loggerLabelStyle,e,...t)}};c=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ConfigInjections.config)),i("design:paramtypes",[Object])],c),t.Logger=c},5470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigInjections=void 0,(t.ConfigInjections||(t.ConfigInjections={})).config="config"},1106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRegex=t.queue=t.delay=t.parseUrl=t.debounce=t.DEFAULT_DEBOUNCE_TIME=t.pipe=t.uuid=t.isIframe=void 0,t.isIframe=function(){try{return window.self!==window.top}catch{return!0}},t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.pipe=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),t.DEFAULT_DEBOUNCE_TIME=150,t.debounce=(e,n=t.DEFAULT_DEBOUNCE_TIME)=>{let r=0;return(...t)=>{clearTimeout(r),r=setTimeout((()=>e(...t)),n)}},t.parseUrl=e=>{try{return new URL(e)}catch{return e}},t.delay=async e=>{await new Promise((t=>setTimeout(t,e,!0)))},t.queue=(e=1)=>{const t=[],n=[];return async function r(i){if(t.length<e){if(t.push(i),await i(),t.shift(),n.length){const e=n.shift();r(e.callback).then((t=>e.resolve(t)))}}else await new Promise((e=>{n.push({resolve:e,callback:i})}))}},t.getRegex=e=>{const t="object"==typeof e;try{return t?new RegExp(e.regex,e.flags):new RegExp(e,"i")}catch{return t?new RegExp(e.regex,"i"):new RegExp(e,"i")}}},1272:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;const i=n(3580);let o=class{constructor(){this.listeners={}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach((e=>{e(t)}))}subscribe(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}clear(e=[]){this.listeners=e.reduce(((e,t)=>({...e,[t]:this.listeners[t]})),{})}};o=r([(0,i.injectable)()],o),t.Observer=o},8826:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optionalPermissions=t.requiredPermissions=void 0,t.requiredPermissions={origins:["<all_urls>"],permissions:["storage","alarms","scripting"]},t.optionalPermissions={origins:["<all_urls>"],permissions:["webNavigation"]}},4940:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.RESERVED_VARIABLES=void 0,(n=t.RESERVED_VARIABLES||(t.RESERVED_VARIABLES={})).$url="$url",n.$shopify="$shopify",n.$event="$event",n.$element="$element",n.$parent="$parent",n.$child="$child",n.$data="$data",n.$scope="$scope",n.$elementValue="$elementValue",n.$globalThis="$globalThis"},6444:(e,t)=>{"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageScriptType=t.MessageContentType=void 0,(r=t.MessageContentType||(t.MessageContentType={})).ECOMMERCE_INIT="ECOMMERCE_INIT",r.ECOMMERCE_RE_INIT="ECOMMERCE_RE_INIT",r.ECOMMERCE_TRACK="ECOMMERCE_TRACK",r.ECOMMERCE_RUNTIME_STORAGE_SAVE="ECOMMERCE_RUNTIME_STORAGE_SAVE",r.ECOMMERCE_RUNTIME_STORAGE_REMOVE="ECOMMERCE_RUNTIME_STORAGE_REMOVE",r.ERROR_TRACE="ERROR_TRACE",r.ECOMMERCE_INIT_SHOPIFY="ECOMMERCE_INIT_SHOPIFY",(n=t.MessageScriptType||(t.MessageScriptType={})).INIT_HTTP_CONFIG="INIT_HTTP_CONFIG",n.SAVE_HTTP_DATA="SAVE_HTTP_DATA",n.CUSTOM_ON_URL_CHANGED="CUSTOM_ON_URL_CHANGED",n.SHOPIFY_DETECTED="SHOPIFY_DETECTED"},3580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AsyncContainerModule:()=>Ye,BindingScopeEnum:()=>v,BindingTypeEnum:()=>_,Container:()=>We,ContainerModule:()=>Je,LazyServiceIdentifer:()=>W,LazyServiceIdentifier:()=>W,METADATA_KEY:()=>pt,MetadataReader:()=>B,TargetTypeEnum:()=>m,createTaggedDecorator:()=>Xe,decorate:()=>tt,getServiceIdentifierAsString:()=>L,id:()=>w,inject:()=>at,injectable:()=>nt,interfaces:()=>ft,multiBindToService:()=>fe,multiInject:()=>ut,named:()=>it,namedConstraint:()=>ke,optional:()=>st,postConstruct:()=>dt,preDestroy:()=>gt,tagged:()=>rt,taggedConstraint:()=>Pe,targetName:()=>lt,traverseAncerstors:()=>Re,typeConstraint:()=>Ne,unmanaged:()=>ct});var r={};n.r(r),n.d(r,{DESIGN_PARAM_TYPES:()=>d,INJECT_TAG:()=>c,MULTI_INJECT_TAG:()=>u,NAMED_TAG:()=>i,NAME_TAG:()=>o,NON_CUSTOM_TAG_KEYS:()=>y,OPTIONAL_TAG:()=>s,PARAM_TYPES:()=>f,POST_CONSTRUCT:()=>g,PRE_DESTROY:()=>p,TAGGED:()=>l,TAGGED_PROP:()=>h,UNMANAGED_TAG:()=>a});var i="named",o="name",a="unmanaged",s="optional",c="inject",u="multi_inject",l="inversify:tagged",h="inversify:tagged_props",f="inversify:paramtypes",d="design:paramtypes",g="post_construct",p="pre_destroy",y=[c,u,o,a,i,s],v={Request:"Request",Singleton:"Singleton",Transient:"Transient"},_={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},m={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},b=0;function w(){return b++}var S=function(){function e(e,t){this.id=w(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=_.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===v.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t},e}(),C="Cannot apply @injectable decorator multiple times.",M="Metadata key was used more than once in a parameter:",E="NULL argument",j="Key Not Found",A="Ambiguous match found for serviceIdentifier:",T="No matching bindings found for serviceIdentifier:",I="Missing required @injectable annotation in:",O="Missing required @inject or @multiInject annotation in:",R="Circular dependency found:",P="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",k=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},N=function(e,t){return"onDeactivation() error in class "+e+": "+t},D="Maximum call stack size exceeded",B=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(f,e),userGeneratedMetadata:Reflect.getMetadata(l,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(h,e)||[]},e}(),x={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function U(e){return e instanceof RangeError||e.message===D}function L(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function F(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=H(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r}function K(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||K(e.parentRequest,t))}function V(e){e.childRequests.forEach((function(e){if(K(e,e.serviceIdentifier)){var t=function(e){return function e(t,n){void 0===n&&(n=[]);var r=L(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(e);throw new Error(R+" "+t)}V(e)}))}function H(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}var q=function(){function e(e){this.id=w(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}(),$=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===i?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},e}(),G=function(e,t){this.parentContext=e,this.rootRequest=t},W=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}(),J=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}(),Y=function(){function e(e,t,n,r){this.id=w(),this.type=e,this.serviceIdentifier=n;var o="symbol"==typeof t?t.toString().slice(7,-1):t;this.name=new J(o||""),this.identifier=t,this.metadata=new Array;var a=null;"string"==typeof r?a=new $(i,r):r instanceof $&&(a=r),null!==a&&this.metadata.push(a)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++)if(n[t].key===e)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(u)},e.prototype.matchesArray=function(e){return this.matchesTag(u)(e)},e.prototype.isNamed=function(){return this.hasTag(i)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return y.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(s)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===i}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return y.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(i)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}(),z=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Q(e,t,n,r){var i=e.getConstructorMetadata(n),o=i.compilerGeneratedMetadata;if(void 0===o)throw new Error(I+" "+t+".");var a=i.userGeneratedMetadata,s=Object.keys(a),c=0===n.length&&s.length>0,u=s.length>n.length,l=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=X(a,e,t,n,r);null!==s&&o.push(s)}return o}(r,t,o,a,c||u?s.length:n.length),h=ee(e,n,t);return z(z([],l,!0),h,!0)}function X(e,t,n,r,i){var o=i[e.toString()]||[],a=ne(o),s=!0!==a.unmanaged,c=r[e];if((c=a.inject||a.multiInject||c)instanceof W&&(c=c.unwrap()),s){if(!t&&(c===Object||c===Function||void 0===c))throw new Error(O+" argument "+e+" in class "+n+".");var u=new Y(m.ConstructorArgument,a.targetName,c);return u.metadata=o,u}return null}function Z(e,t,n,r){var i=e||t;if(void 0===i){var o=I+" for property "+String(n)+" in class "+r+".";throw new Error(o)}return i}function ee(e,t,n){for(var r=e.getPropertiesMetadata(t),i=[],o=Object.getOwnPropertySymbols(r),a=0,s=Object.keys(r).concat(o);a<s.length;a++){var c=s[a],u=r[c],l=ne(u),h=l.targetName||c,f=Z(l.inject,l.multiInject,c,n),d=new Y(m.ClassProperty,h,f);d.metadata=u,i.push(d)}var g=Object.getPrototypeOf(t.prototype).constructor;if(g!==Object){var p=ee(e,g,n);i=z(z([],i,!0),p,!0)}return i}function te(e,t){var n=Object.getPrototypeOf(t.prototype).constructor;if(n!==Object){var r=Q(e,H(n),n,!0),i=r.map((function(e){return e.metadata.filter((function(e){return e.key===a}))})),o=[].concat.apply([],i).length,s=r.length-o;return s>0?s:te(e,n)}return 0}function ne(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[c],multiInject:t[u],targetName:t[o],unmanaged:t[a]}}var re=function(){function e(e,t,n,r,i){this.id=w(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();function ie(e){return e._bindingDictionary}function oe(e,t,n,r,i){var o,a=se(n.container,i.serviceIdentifier);return a.length===x.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=se(n.container,i.serviceIdentifier)),o=t?a:a.filter((function(e){var t=new re(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case x.NoBindingsAvailable:if(n.isOptional())return t;var i=L(e),o=T;throw o+=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e}(i,n),o+=F(r,i,se),new Error(o);case x.OnlyOneBindingAvailable:return t;case x.MultipleBindingsAvailable:default:if(n.isArray())return t;throw i=L(e),o=A+" "+i,o+=F(r,i,se),new Error(o)}}(i.serviceIdentifier,o,i,n.container),o}function ae(e,t,n,r,i,o){var a,s;if(null===i){a=oe(e,t,r,null,o),s=new re(n,r,null,a,o);var c=new G(r,s);r.addPlan(c)}else a=oe(e,t,r,i,o),s=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(t){var n=null;if(o.isArray())n=s.addChildRequest(t.serviceIdentifier,t,o);else{if(t.cache)return;n=s}if(t.type===_.Instance&&null!==t.implementationType){var i=function(e,t){return Q(e,H(t),t,!1)}(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var a=te(e,t.implementationType);if(i.length<a){var c=k(H(t.implementationType));throw new Error(c)}}i.forEach((function(t){ae(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function se(e,t){var n=[],r=ie(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=se(e.parent,t)),n}function ce(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function ue(e){return!!ce(e)||Array.isArray(e)&&e.some(ce)}var le,he=function(e,t){return n=void 0,r=void 0,o=function(){var n,r;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t];case 1:return n=i.sent(),e.cache=n,[3,3];case 2:throw r=i.sent(),e.cache=null,e.activated=!1,r;case 3:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{c(o.next(e))}catch(e){t(e)}}function s(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((o=o.apply(n,r||[])).next())}));var n,r,i,o};!function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"}(le||(le={}));var fe=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}},de=function(){return de=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},de.apply(this,arguments)},ge=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},pe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ye=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function ve(e){var t,n=new((t=e.constr).bind.apply(t,ye([void 0],e.constructorInjections,!1)));return e.propertyRequests.forEach((function(t,r){var i=t.target.identifier,o=e.propertyInjections[r];t.target.isOptional()&&void 0===o||(n[i]=o)})),n}function _e(e){return ge(this,void 0,void 0,(function(){var t,n,r,i;return pe(this,(function(o){for(t=[],n=0,r=e;n<r.length;n++)i=r[n],Array.isArray(i)?t.push(Promise.all(i)):t.push(i);return[2,Promise.all(t)]}))}))}function me(e,t){var n=function(e,t){var n,r,i,o;if(Reflect.hasMetadata(g,e)){var a=Reflect.getMetadata(g,e);try{return null===(r=(n=t)[a.value])||void 0===r?void 0:r.call(n)}catch(t){if(t instanceof Error)throw new Error((i=e.name,o=t.message,"@postConstruct error in class "+i+": "+o))}}}(e,t);return ce(n)?n.then((function(){return t})):t}var be=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,r=t.childRequests,i=t.target&&t.target.isArray(),o=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(i&&o)return r.map((function(t){return be(e)(t)}));if(!t.target.isOptional()||0!==n.length){var a=n[0];return Me(e,t,a)}}},we=function(e,t){var n=function(e){switch(e.type){case _.Factory:return{factory:e.factory,factoryType:le.Factory};case _.Provider:return{factory:e.provider,factoryType:le.Provider};case _.DynamicValue:return{factory:e.dynamicValue,factoryType:le.DynamicValue};default:throw new Error("Unexpected factory type "+e.type)}}(e);return function(r,i){try{return n.factory.bind(e)(t)}catch(e){throw U(e)&&(e=new Error((o=n.factoryType,a=t.currentRequest.serviceIdentifier.toString(),"It looks like there is a circular dependency in one of the '"+o+"' bindings. Please investigate bindings with service identifier '"+a+"'."))),e}var o,a}()},Se=function(e,t,n){var r,i=t.childRequests;switch(function(e){var t=null;switch(e.type){case _.ConstantValue:case _.Function:t=e.cache;break;case _.Constructor:case _.Instance:t=e.implementationType;break;case _.DynamicValue:t=e.dynamicValue;break;case _.Provider:t=e.provider;break;case _.Factory:t=e.factory}if(null===t){var n=L(e.serviceIdentifier);throw new Error("Invalid binding type: "+n)}}(n),n.type){case _.ConstantValue:case _.Function:r=n.cache;break;case _.Constructor:r=n.implementationType;break;case _.Instance:r=function(e,t,n,r){!function(e,t){e.scope!==v.Singleton&&function(e,t){var n="Class cannot be instantiated in "+(e.scope===v.Request?"request":"transient")+" scope.";if("function"==typeof e.onDeactivation)throw new Error(N(t.name,n));if(Reflect.hasMetadata(p,t))throw new Error("@preDestroy error in class "+t.name+": "+n)}(e,t)}(e,t);var i=function(e,t,n){var r;if(t.length>0){var i=function(e,t){return e.reduce((function(e,n){var r=t(n);return n.target.type===m.ConstructorArgument?e.constructorInjections.push(r):(e.propertyRequests.push(n),e.propertyInjections.push(r)),e.isAsync||(e.isAsync=ue(r)),e}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}(t,n),o=de(de({},i),{constr:e});r=i.isAsync?function(e){return ge(this,void 0,void 0,(function(){var t,n;return pe(this,(function(r){switch(r.label){case 0:return[4,_e(e.constructorInjections)];case 1:return t=r.sent(),[4,_e(e.propertyInjections)];case 2:return n=r.sent(),[2,ve(de(de({},e),{constructorInjections:t,propertyInjections:n}))]}}))}))}(o):ve(o)}else r=new e;return r}(t,n,r);return ce(i)?i.then((function(e){return me(t,e)})):me(t,i)}(n,n.implementationType,i,be(e));break;default:r=we(n,t.parentContext)}return r},Ce=function(e,t,n){var r=function(e,t){return t.scope===v.Singleton&&t.activated?t.cache:t.scope===v.Request&&e.has(t.id)?e.get(t.id):null}(e,t);return null!==r||function(e,t,n){t.scope===v.Singleton&&function(e,t){e.cache=t,e.activated=!0,ce(t)&&he(e,t)}(t,n),t.scope===v.Request&&function(e,t,n){e.has(t.id)||e.set(t.id,n)}(e,t,n)}(e,t,r=n()),r},Me=function(e,t,n){return Ce(e,n,(function(){var r=Se(e,t,n);return ce(r)?r.then((function(e){return Ee(t,n,e)})):Ee(t,n,r)}))};function Ee(e,t,n){var r,i=je(e.parentContext,t,n),o=Oe(e.parentContext.container),a=o.next();do{r=a.value;var s=e.parentContext,c=e.serviceIdentifier,u=Ie(r,c);i=ce(i)?Te(u,s,i):Ae(u,s,i),a=o.next()}while(!0!==a.done&&!ie(r).hasKey(e.serviceIdentifier));return i}var je=function(e,t,n){return"function"==typeof t.onActivation?t.onActivation(e,n):n},Ae=function(e,t,n){for(var r=e.next();!r.done;){if(ce(n=r.value(t,n)))return Te(e,t,n);r=e.next()}return n},Te=function(e,t,n){return r=void 0,i=void 0,a=function(){var r,i;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(o){switch(o.label){case 0:return[4,n];case 1:r=o.sent(),i=e.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(t,r)];case 3:return r=o.sent(),i=e.next(),[3,2];case 4:return[2,r]}}))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,s)}c((a=a.apply(r,i||[])).next())}));var r,i,o,a},Ie=function(e,t){var n=e._activations;return n.hasKey(t)?n.get(t).values():[].values()},Oe=function(e){for(var t=[e],n=e.parent;null!==n;)t.push(n),n=n.parent;return{next:function(){var e=t.pop();return void 0!==e?{done:!1,value:e}:{done:!0,value:void 0}}}},Re=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||Re(n,t))},Pe=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new $(e,t),n}},ke=Pe(i),Ne=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}},De=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new Be(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=ke(e),new Be(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e&&null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new Be(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=Pe(e)(t),new Be(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return null!==t&&Ne(e)(t.parentRequest)},new Be(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return null!==t&&ke(e)(t.parentRequest)},new Be(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Pe(e)(t)(n.parentRequest)},new Be(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&Re(t,Ne(e))},new Be(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&!Re(t,Ne(e))},new Be(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Re(t,ke(e))},new Be(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&!Re(t,ke(e))},new Be(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Re(n,Pe(e)(t))},new Be(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&!Re(n,Pe(e)(t))},new Be(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&Re(t,e)},new Be(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&!Re(t,e)},new Be(this._binding)},e}(),Be=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new De(this._binding)},e.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new De(this._binding)},e}(),xe=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new De(this._binding),this._bindingOnSyntax=new Be(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Ue=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=v.Request,new xe(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=v.Transient,new xe(this._binding)},e}(),Le=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new De(this._binding),this._bindingOnSyntax=new Be(this._binding),this._bindingInSyntax=new Ue(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Fe=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=_.Instance,this._binding.implementationType=e,new Le(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=_.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=_.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Le(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=_.Constructor,this._binding.implementationType=e,this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=_.Factory,this._binding.factory=e,this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error("Value provided to function binding must be a function!");var t=this.toConstantValue(e);return this._binding.type=_.Function,this._binding.scope=v.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=_.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.toAutoNamedFactory=function(e){return this._binding.type=_.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new xe(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=_.Provider,this._binding.provider=e,this._binding.scope=v.Singleton,new xe(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}(),Ke=function(){function e(){}return e.of=function(t,n,r,i,o){var a=new e;return a.bindings=t,a.middleware=n,a.deactivations=i,a.activations=r,a.moduleActivationStore=o,a},e}(),Ve=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(E);if(null==t)throw new Error(E);var n=this._map.get(e);void 0!==n?n.push(t):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(E);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(j)},e.prototype.remove=function(e){if(null==e)throw new Error(E);if(!this._map.delete(e))throw new Error(j)},e.prototype.removeIntersection=function(e){var t=this;this.traverse((function(n,r){var i=e.hasKey(n)?e.get(n):void 0;if(void 0!==i){var o=r.filter((function(e){return!i.some((function(t){return e===t}))}));t._setValue(n,o)}}))},e.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach((function(r,i){for(var o=[],a=0,s=r;a<s.length;a++){var c=s[a];e(c)?n.push(c):o.push(c)}t._setValue(i,o)})),n},e.prototype.hasKey=function(e){if(null==e)throw new Error(E);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,"object"==typeof(r=e)&&null!==r&&"clone"in r&&"function"==typeof r.clone?e.clone():e);var r}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},e}(),He=function(){function e(){this._map=new Map}return e.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},e.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},e.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){t._map.set(n,{onActivations:e.onActivations.clone(),onDeactivations:e.onDeactivations.clone()})})),t},e.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return void 0===t&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},e.prototype._getEmptyHandlersStore=function(){return{onActivations:new Ve,onDeactivations:new Ve}},e}(),qe=function(){return qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},qe.apply(this,arguments)},$e=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Ge=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},We=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error("Invalid Container constructor argument. Container options must be an object.");if(void 0===t.defaultScope)t.defaultScope=v.Transient;else if(t.defaultScope!==v.Singleton&&t.defaultScope!==v.Transient&&t.defaultScope!==v.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=w(),this._bindingDictionary=new Ve,this._snapshots=[],this._middleware=null,this._activations=new Ve,this._deactivations=new Ve,this.parent=null,this._metadataReader=new B,this._moduleActivationStore=new He}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,a=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([t,n],r,!0).map((function(e){return ie(e)})),s=ie(o);return a.forEach((function(e){var t;t=s,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e(this,void 0,void 0,(function(){var t,n,r,i,o;return Ge(this,(function(a){switch(a.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],o=t(i.id),[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n=e._removeModuleBindings(t.id);e._deactivateSingletons(n),e._removeModuleHandlers(t.id)}))},e.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e(this,void 0,void 0,(function(){var t,n,r,i;return Ge(this,(function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(r=n[t],i=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(i)]):[3,4];case 2:o.sent(),this._removeModuleHandlers(r.id),o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.bind=function(e){var t=this.options.defaultScope||v.Transient,n=new S(e,t);return this._bindingDictionary.add(e,n),new Fe(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.rebindAsync=function(e){return $e(this,void 0,void 0,(function(){return Ge(this,(function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}}))}))},e.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},e.prototype.unbindAsync=function(e){return $e(this,void 0,void 0,(function(){var t;return Ge(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}}))}))},e.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse((function(t,n){e._deactivateSingletons(n)})),this._bindingDictionary=new Ve},e.prototype.unbindAllAsync=function(){return $e(this,void 0,void 0,(function(){var e,t=this;return Ge(this,(function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse((function(n,r){e.push(t._deactivateSingletonsAsync(r))})),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new Ve,[2]}}))}))},e.prototype.onActivation=function(e,t){this._activations.add(e,t)},e.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,i,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=function(e,t,n,r){var i=new Y(m.Variable,"",t,new $(n,r)),o=new q(e);return new re(t,o,null,[],i)}(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(Ke.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},e.prototype.getAsync=function(e){return $e(this,void 0,void 0,(function(){var t;return Ge(this,(function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]}))}))},e.prototype.getTagged=function(e,t,n){var r=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(r)},e.prototype.getTaggedAsync=function(e,t,n){return $e(this,void 0,void 0,(function(){var r;return Ge(this,(function(i){return r=this._getNotAllArgs(e,!1,t,n),[2,this._get(r)]}))}))},e.prototype.getNamed=function(e,t){return this.getTagged(e,i,t)},e.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,i,t)},e.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},e.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},e.prototype.getAllTagged=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(r)},e.prototype.getAllTaggedAsync=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getAll(r)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,i,t)},e.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,i,t)},e.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},e.prototype._preDestroy=function(e,t){var n,r;if(Reflect.hasMetadata(p,e))return null===(r=(n=t)[Reflect.getMetadata(p,e).value])||void 0===r?void 0:r.call(n)},e.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},e.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition((function(t){return t.moduleId===e}))},e.prototype._deactivate=function(e,t){var n=this,r=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var i=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(ce(i))return this._handleDeactivationError(i.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)})),r)}var o=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(ce(o))return this._handleDeactivationError(o,r)}catch(e){if(e instanceof Error)throw new Error(N(r.name,e.message))}},e.prototype._handleDeactivationError=function(e,t){return $e(this,void 0,void 0,(function(){var n;return Ge(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e];case 1:return r.sent(),[3,3];case 2:if((n=r.sent())instanceof Error)throw new Error(N(t.name,n.message));return[3,3];case 3:return[2]}}))}))},e.prototype._deactivateContainer=function(e,t){for(var n=this,r=t.next();r.value;){var i=r.value(e);if(ce(i))return i.then((function(){return n._deactivateContainerAsync(e,t)}));r=t.next()}},e.prototype._deactivateContainerAsync=function(e,t){return $e(this,void 0,void 0,(function(){var n;return Ge(this,(function(r){switch(r.label){case 0:n=t.next(),r.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return r.sent(),n=t.next(),[3,1];case 3:return[2]}}))}))},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind(r);return t(i,n),i}},r=function(t){return function(n,r){e._moduleActivationStore.addActivation(t,n,r),e.onActivation(n,r)}},i=function(t){return function(n,r){e._moduleActivationStore.addDeactivation(t,n,r),e.onDeactivation(n,r)}};return function(o){return{bindFunction:(a=o,function(n){var r=e.bind(n);return t(r,a),r}),isboundFunction:function(t){return e.isBound(t)},onActivationFunction:r(o),onDeactivationFunction:i(o),rebindFunction:n(o),unbindFunction:function(t){return e.unbind(t)},unbindAsyncFunction:function(t){return e.unbindAsync(t)}};var a}},e.prototype._getAll=function(e){return Promise.all(this._get(e))},e.prototype._get=function(e){var t=qe(qe({},e),{contextInterceptor:function(e){return e},targetType:m.Variable});if(this._middleware){var n=this._middleware(t);if(null==n)throw new Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(t)},e.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if(ue(t))throw new Error("You are attempting to construct '"+e.serviceIdentifier+"' in a synchronous way\n but it has asynchronous dependencies.");return t},e.prototype._getAllArgs=function(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}},e.prototype._getNotAllArgs=function(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=function(e,t,n,r,i,o,a,s){void 0===s&&(s=!1);var l=new q(t),h=function(e,t,n,r,i,o){var a=new $(e?u:c,n),s=new Y(t,"",n,a);if(void 0!==i){var l=new $(i,o);s.metadata.push(l)}return s}(n,r,i,0,o,a);try{return ae(e,s,i,l,null,h),l}catch(e){throw U(e)&&V(l.plan.rootRequest),e}}(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return function(e){return be(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}(n=t.contextInterceptor(n))}},e.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return ce(e.cache)?e.cache.then((function(n){return t._deactivate(e,n)})):this._deactivate(e,e.cache)},e.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(ce(this._deactivateIfSingleton(r)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}},e.prototype._deactivateSingletonsAsync=function(e){return $e(this,void 0,void 0,(function(){var t=this;return Ge(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t._deactivateIfSingleton(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return $e(this,void 0,void 0,(function(){return Ge(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error("Could not unbind serviceIdentifier: "+L(e))}},e.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var r=this;if("function"==typeof e.onDeactivation){var i=e.onDeactivation(t);if(ce(i))return i.then((function(){return r._preDestroy(n,t)}))}return this._preDestroy(n,t)},e.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return $e(this,void 0,void 0,(function(){return Ge(this,(function(r){switch(r.label){case 0:return"function"!=typeof e.onDeactivation?[3,2]:[4,e.onDeactivation(t)];case 1:r.sent(),r.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return r.sent(),[2]}}))}))},e}(),Je=function(e){this.id=w(),this.registry=e},Ye=function(e){this.id=w(),this.registry=e};function ze(e,t,n,r){!function(e){if(void 0!==e)throw new Error(P)}(t),Qe(l,e,n.toString(),r)}function Qe(e,t,n,r){var i=function(e){var t=[];if(Array.isArray(e)){var n=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i))return i;t.add(i)}}((t=e).map((function(e){return e.key})));if(void 0!==n)throw new Error(M+" "+n.toString())}else t=[e];return t}(r),o={};Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var a=o[n];if(void 0===a)a=[];else for(var s=function(e){if(i.some((function(t){return t.key===e.key})))throw new Error(M+" "+e.key.toString())},c=0,u=a;c<u.length;c++)s(u[c]);a.push.apply(a,i),o[n]=a,Reflect.defineMetadata(e,o,t)}function Xe(e){return function(t,n,r){"number"==typeof r?ze(t,n,r,e):function(e,t,n){if(void 0!==e.prototype)throw new Error(P);Qe(h,e.constructor,t,n)}(t,n,e)}}function Ze(e,t){Reflect.decorate(e,t)}function et(e,t){return function(n,r){t(n,r,e)}}function tt(e,t,n){"number"==typeof n?Ze([et(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):Ze([e],t)}function nt(){return function(e){if(Reflect.hasOwnMetadata(f,e))throw new Error(C);var t=Reflect.getMetadata(d,e)||[];return Reflect.defineMetadata(f,t,e),e}}function rt(e,t){return Xe(new $(e,t))}function it(e){return Xe(new $(i,e))}function ot(e){return function(t){return function(n,r,i){if(void 0===t){var o="function"==typeof n?n.name:n.constructor.name;throw new Error("@inject called with undefined this could mean that the class "+o+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation.")}return Xe(new $(e,t))(n,r,i)}}}var at=ot(c);function st(){return Xe(new $(s,!0))}function ct(){return function(e,t,n){ze(e,t,n,new $(a,!0))}}var ut=ot(u);function lt(e){return function(t,n,r){ze(t,n,r,new $(o,e))}}function ht(e,t){return function(){return function(n,r){var i=new $(e,r);if(Reflect.hasOwnMetadata(e,n.constructor))throw new Error(t);Reflect.defineMetadata(e,i,n.constructor)}}}var ft,dt=ht(g,"Cannot apply @postConstruct decorator multiple times in the same class"),gt=ht(p,"Cannot apply @preDestroy decorator multiple times in the same class");ft||(ft={});var pt=r},4991:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(910),t)},910:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorageAdapter=t.SessionStorage=void 0;const n="__SESSION_STORAGE__";class r{constructor(){this.storage=chrome.storage.local,chrome.runtime.onStartup.addListener((()=>{this.clear()}))}async get(e){if(await this.sessionStorageEmpty())return{};const t=void 0===e,n=Array.isArray(e);if(t)return await this.sessionStorage();const r=await this.sessionStorage();return n?e.reduce(((e,t)=>({...e,...r.hasOwnProperty(t)&&{[t]:r[t]}})),{}):{...r.hasOwnProperty(e)&&{[e]:r[e]}}}async set(e){if(await this.sessionStorageEmpty())return await this.storage.set({[n]:e});const t=await this.sessionStorage();await this.storage.set({[n]:{...t,...e}})}async has(e){if(await this.sessionStorageEmpty())return!1;const t=await this.sessionStorage();return Boolean(t[e])}async remove(e){if(await this.sessionStorageEmpty())return;const t=await this.sessionStorage();(Array.isArray(e)?e:[e]).forEach((e=>{delete t[e]})),await this.storage.set({[n]:t})}async clear(){await this.storage.set({[n]:{}})}async sessionStorage(){return{...(await this.storage.get(n))[n]??{}}}async sessionStorageEmpty(){return 0===Object.keys(await this.sessionStorage()).length}}t.SessionStorage=r,t.SessionStorageAdapter=class{static adapt(){chrome.storage.session||(chrome.storage.session=new r)}}},3960:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3190);t.default=r.default},1519:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0,t.LocalStorage=class{static getItem(e){return n(this,void 0,void 0,(function*(){return yield chrome.storage.local.get(e).then((t=>t[e]))}))}static setItem(e,t){chrome.storage.local.set({[e]:t})}static hasItem(e){return n(this,void 0,void 0,(function*(){return yield this.getItem(e).then(Boolean)}))}static removeItem(e){return n(this,void 0,void 0,(function*(){yield chrome.storage.local.remove(e)}))}}},8582:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Migration_4_0_4=void 0;const i=n(1519);class o{static handle(e){return r(this,void 0,void 0,(function*(){(yield i.LocalStorage.hasItem(this.migrationKey))||(yield i.LocalStorage.removeItem(e),i.LocalStorage.setItem(this.migrationKey,!0))}))}}t.Migration_4_0_4=o,o.migrationKey="PANELIST_MIGRATION_4_0_4"},3190:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1519),a=n(8582),s=(e,t=5e3,n=(()=>null))=>r(void 0,void 0,void 0,(function*(){const{url:r}=e,o=i(e,["url"]),a=new AbortController,s=setTimeout((()=>{a.abort(),n()}),t),c=yield fetch(r,Object.assign(Object.assign({},o),{signal:a.signal}));return clearTimeout(s),c}));t.default=class{constructor(e={}){if("string"!=typeof e.host)throw new Error("PanalyticsUtility: Server host is undefined");this.config=e}synchronize(){return r(this,void 0,void 0,(function*(){const e=yield this.loadKey();yield this.globalSetter(e)}))}getKey(e){this.getKeyAsync().then(e)}getKeyAsync(){return r(this,void 0,void 0,(function*(){const e=yield this.loadKey();if(e)return yield this.provideKeyToStorage(e),e;const t=yield this.getLocalKey();return yield this.setKey(t),t}))}get localGeneratedKey(){return Symbol.for(`__${this.storageSyncKey}__`)}get storageSyncKey(){var e;return null!==(e=this.config.storageKey)&&void 0!==e?e:"panalyticsid"}get cacheResourceUrl(){return`${this.config.host}/api/identity/cache`}get cookieResourceUrl(){return`${this.config.host}/api/identity/cookie`}loadKey(){return r(this,void 0,void 0,(function*(){return yield a.Migration_4_0_4.handle(this.storageSyncKey),yield new Promise((e=>r(this,void 0,void 0,(function*(){const t=[this.localStorageGetter.bind(this),this.cacheGetter.bind(this),this.cookieGetter.bind(this)];for(const n of t){const t=yield n();if(t)return void e(t)}e()}))))}))}getLocalKey(){return r(this,void 0,void 0,(function*(){return globalThis[this.localGeneratedKey]||(globalThis[this.localGeneratedKey]=new Promise((e=>{e(this.generateKey())}))),yield globalThis[this.localGeneratedKey]}))}generateKey(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length;for(let r=0;r<22;r++)e+=t.charAt(Math.floor(Math.random()*n));return this.log(`key generated locally: ${e}`),e}setKey(e){return r(this,void 0,void 0,(function*(){yield this.globalSetter(e)}))}localStorageGetter(){return r(this,void 0,void 0,(function*(){this.log(`localStorageGetter: try to get "${this.storageSyncKey}" from localStorage.`);const e=yield o.LocalStorage.getItem(this.storageSyncKey);return e?this.log(`localStorageGetter: "${this.storageSyncKey}" has been found in localStorage. Value: "${e}"`):this.log(`localStorageGetter: "${this.storageSyncKey}" has not been found in localStorage.`),e}))}localStorageSetter(e){this.log(`localStorageSetter: "${this.storageSyncKey}" is going to be stored in localStorage.`),o.LocalStorage.setItem(this.storageSyncKey,e)}provideKeyToStorage(e){return r(this,void 0,void 0,(function*(){(yield o.LocalStorage.hasItem(this.storageSyncKey))||this.localStorageSetter(e)}))}cacheGetter(){return r(this,void 0,void 0,(function*(){this.log(`CacheGetter: try to get "${this.storageSyncKey}" from cache.`);const e=this;return yield new Promise((t=>{s({url:this.cacheResourceUrl,method:"GET"},1e3,(()=>{e.log("CacheGetter: Caching request is timed out."),t()})).then((n=>{200===n.status?n.json().then((n=>{const r=n.userKey;r?(e.log(`CacheGetter: "${e.storageSyncKey}" has been found in cache. Value: "${r}"`),t(r)):t()})).catch((()=>{e.log(`CacheGetter: Error occurred while retrieving "${e.storageSyncKey}" from cache.`),t()})):(e.log("CacheGetter: Caching request has been failed."),t())})).catch((()=>{t()}))}))}))}cacheSetter(e){return r(this,void 0,void 0,(function*(){this.log(`CacheSetter: "${this.storageSyncKey}" is going to be stored in cache.`);const t=this;return yield new Promise((n=>{fetch(this.cacheResourceUrl,{headers:{"X-PANEL-USER-KEY":e,"Cache-Control":"no-cache"},method:"GET"}).then((r=>{200===r.status?(t.log("CacheSetter: Caching request to server has been succeeded."),n(e)):(t.log("CacheSetter: Caching request has been failed."),n())})).catch((()=>{n()}))}))}))}cookieGetter(){return r(this,void 0,void 0,(function*(){this.log(`CookieGetter: try to get "${this.storageSyncKey}" from cookie.`);const e=this;return yield new Promise((t=>{s({credentials:"include",method:"GET",url:this.cookieResourceUrl},5e3,(()=>{e.log("CookieGetter: Request is timed out."),t()})).then((n=>{200===n.status?n.json().then((n=>{n.userKey?(e.log(`CookieGetter: "${e.storageSyncKey}" has been found in cookie. Value: "${n.userKey}"`),t(n.userKey)):(e.log(`CookieGetter: "${e.storageSyncKey}" has not been found in cookie. `),t())})).catch((()=>{e.log(`CookieGetter: Error occurred while retrieving "${e.storageSyncKey}" from cookie.`),t()})):(e.log("CookieGetter: Cookie request has been failed."),t())})).catch((()=>{t()}))}))}))}cookieSetter(e){return r(this,void 0,void 0,(function*(){this.log(`CookieSetter: "${this.storageSyncKey}" is going to be stored in cookie.`);const t=this;return yield new Promise((n=>{const r=`${this.cookieResourceUrl}?userKey=${e}`;fetch(r,{credentials:"include",method:"POST"}).then((r=>{200===r.status?(t.log("CookieSetter: cookie request has been succeeded."),n(e)):(t.log("CookieSetter: cookie request has been failed."),n())})).catch((()=>{n()}))}))}))}cookieClear(){return r(this,void 0,void 0,(function*(){this.log(`CookieClearer: "${this.storageSyncKey}" is going to be deleted.`);const e=this;yield new Promise((t=>{fetch(this.cookieResourceUrl,{credentials:"include",method:"DELETE"}).then((n=>{200===n.status?(e.log("CookieClearer: cookie request has been succeeded."),t()):(e.log("CookieClearer: cookie request has been failed."),t())})).catch((()=>{t()}))}))}))}globalSetter(e){return r(this,void 0,void 0,(function*(){e?(this.localStorageSetter(e),yield this.cacheSetter(e),yield this.cookieClear(),yield this.cookieSetter(e)):this.log("Value provided to global setter is invalid.")}))}log(e){this.config.logging&&console.log("%c[PanalyticsUtility]","background-color: rgba(84,174,255,0.4); font-weight: bold; padding: 2px;",e)}}},6961:(e,t,n)=>{var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,(function(n){return i(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":o._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var a=t.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var n=new Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var a=[];return n.forEach((function(t){a.push(e(t))})),o.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,(function(t){return i(n,e.charAt(t))})))},compress:function(t){return o._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var r,i,o,a={},s={},c="",u="",l="",h=2,f=3,d=2,g=[],p=0,y=0;for(o=0;o<e.length;o+=1)if(c=e.charAt(o),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=f++,s[c]=!0),u=l+c,Object.prototype.hasOwnProperty.call(a,u))l=u;else{if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<d;r++)p<<=1,y==t-1?(y=0,g.push(n(p)),p=0):y++;for(i=l.charCodeAt(0),r=0;r<8;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1}else{for(i=1,r=0;r<d;r++)p=p<<1|i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i=0;for(i=l.charCodeAt(0),r=0;r<16;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1}0==--h&&(h=Math.pow(2,d),d++),delete s[l]}else for(i=a[l],r=0;r<d;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1;0==--h&&(h=Math.pow(2,d),d++),a[u]=f++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<d;r++)p<<=1,y==t-1?(y=0,g.push(n(p)),p=0):y++;for(i=l.charCodeAt(0),r=0;r<8;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1}else{for(i=1,r=0;r<d;r++)p=p<<1|i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i=0;for(i=l.charCodeAt(0),r=0;r<16;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1}0==--h&&(h=Math.pow(2,d),d++),delete s[l]}else for(i=a[l],r=0;r<d;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1;0==--h&&(h=Math.pow(2,d),d++)}for(i=2,r=0;r<d;r++)p=p<<1|1&i,y==t-1?(y=0,g.push(n(p)),p=0):y++,i>>=1;for(;;){if(p<<=1,y==t-1){g.push(n(p));break}y++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,r){var i,o,a,s,c,u,l,h=[],f=4,d=4,g=3,p="",y=[],v={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(a=0,c=Math.pow(2,2),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;l=e(a);break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;l=e(a);break;case 2:return""}for(h[3]=l,o=l,y.push(l);;){if(v.index>t)return"";for(a=0,c=Math.pow(2,g),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;switch(l=a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;h[d++]=e(a),l=d-1,f--;break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;h[d++]=e(a),l=d-1,f--;break;case 2:return y.join("")}if(0==f&&(f=Math.pow(2,g),g++),h[l])p=h[l];else{if(l!==d)return null;p=o+o.charAt(0)}y.push(p),h[d++]=o+p.charAt(0),o=p,0==--f&&(f=Math.pow(2,g),g++)}}};return o}();void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)},8660:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=o(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,c={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),l="object"==typeof process&&"true"==="MISSING_ENV_VAR".REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,f=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(l||"function"!=typeof WeakMap?function(){var e=16,n=c.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+s()}while(c.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t,n=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t));n[6]=79&n[6]|64,n[8]=191&n[8]|128;for(var r="",i=0;i<e;++i){var o=n[i];4!==i&&6!==i&&8!==i||(r+="-"),o<16&&(r+="0"),r+=o.toString(16).toLowerCase()}return r}}():WeakMap);function g(e,t,n){var r=d.get(e);if(C(r)){if(!n)return;r=new h,d.set(e,r)}var i=r.get(t);if(C(i)){if(!n)return;i=new h,r.set(t,i)}return i}function p(e,t,n){if(y(e,t,n))return!0;var r=N(t);return!M(r)&&p(e,r,n)}function y(e,t,n){var r=g(t,n,!1);return!C(r)&&!!r.has(e)}function v(e,t,n){if(y(e,t,n))return _(e,t,n);var r=N(t);return M(r)?void 0:v(e,r,n)}function _(e,t,n){var r=g(t,n,!1);if(!C(r))return r.get(e)}function m(e,t,n,r){g(n,r,!0).set(e,t)}function b(e,t){var n=w(e,t),r=N(e);if(null===r)return n;var i=b(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new f,a=[],s=0,c=n;s<c.length;s++){var u=c[s];o.has(u)||(o.add(u),a.push(u))}for(var l=0,h=i;l<h.length;l++)u=h[l],o.has(u)||(o.add(u),a.push(u));return a}function w(e,t){var n=[],r=g(e,t,!1);if(C(r))return n;for(var o=function(e){var t=R(e,i);if(!I(t))throw new TypeError;var n=t.call(e);if(!E(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=P(o);if(!s)return n.length=a,n;var c=s.value;try{n[a]=c}catch(e){try{k(o)}finally{throw e}}a++}}function S(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function C(e){return void 0===e}function M(e){return null===e}function E(e){return"object"==typeof e?null!==e:"function"==typeof e}function j(e,t){switch(S(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=R(e,r);if(void 0!==i){var o=i.call(e,n);if(E(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(I(n)&&!E(i=n.call(e)))return i;if(I(r=e.valueOf)&&!E(i=r.call(e)))return i}else{var r;if(I(r=e.valueOf)&&!E(i=r.call(e)))return i;var i,o=e.toString;if(I(o)&&!E(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=j(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function T(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function I(e){return"function"==typeof e}function O(e){return"function"==typeof e}function R(e,t){var n=e[t];if(null!=n){if(!I(n))throw new TypeError;return n}}function P(e){var t=e.next();return!t.done&&t}function k(e){var t=e.return;t&&t.call(e)}function N(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function D(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(C(n)){if(!T(e))throw new TypeError;if(!O(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!C(r)&&!M(r)){if(!O(r))throw new TypeError;t=r}}return t}(e,t)}if(!T(e))throw new TypeError;if(!E(t))throw new TypeError;if(!E(r)&&!C(r)&&!M(r))throw new TypeError;return M(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!C(o)&&!M(o)){if(!E(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!E(n))throw new TypeError;if(!C(r)&&!function(e){switch(S(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!E(n))throw new TypeError;return C(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return C(n)||(n=A(n)),p(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return C(n)||(n=A(n)),y(e,t,n)})),e("getMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return C(n)||(n=A(n)),v(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return C(n)||(n=A(n)),_(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!E(e))throw new TypeError;return C(t)||(t=A(t)),b(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!E(e))throw new TypeError;return C(t)||(t=A(t)),w(e,t)})),e("deleteMetadata",(function(e,t,n){if(!E(t))throw new TypeError;C(n)||(n=A(n));var r=g(t,n,!1);if(C(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(i)}()}(r||(r={}))},6661:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ECommerceModule=void 0,n(8224);const i=n(1578),o=()=>r(void 0,void 0,void 0,(function*(){const e={logging:a.logging,version:{extension:chrome.runtime.getManifest().version},priceTrend:a.priceTrend,auth:a.auth,client:{distributorId:a.distributorId,id:a.clientId,panelId:a.panelId,partnerId:a.partnerId},stackTrace:a.stackTrace,coupon:a.coupon,syncUp:a.syncUp,compression:a.compression,track:{api:a.trackApi,tracking:!0},watchers:[]};s=yield(0,i.createStream)(e),c=!0}));let a;chrome.permissions.onAdded.addListener((()=>r(void 0,void 0,void 0,(function*(){const e=yield(0,i.useStream)();yield e.syncUp()}))));let s,c=!1;class u{constructor(e){a=e}__init__(){return r(this,void 0,void 0,(function*(){if(c)throw new Error("Stream was already init!");(yield this.isPolicyAgreed())&&(yield o(),yield u.enableStream())}))}isPolicyAgreed(){return r(this,void 0,void 0,(function*(){const{__POLICY_AGREEMENT__:e}=yield chrome.storage.local.get("__POLICY_AGREEMENT__");return Boolean(e)}))}setPolicyStatus(e){return r(this,void 0,void 0,(function*(){(yield this.isPolicyAgreed())||(yield chrome.storage.local.set({__POLICY_AGREEMENT__:e}),e&&(yield o(),yield u.enableStream()))}))}setIp(e){return r(this,void 0,void 0,(function*(){u.checkStreamInitiated(),s.setIp(e)}))}getPriceTrend(e){return r(this,void 0,void 0,(function*(){return u.checkStreamInitiated(),yield s.getPriceTrend(e)}))}getSavedCoupons(e){return r(this,void 0,void 0,(function*(){return u.checkStreamInitiated(),yield s.getSavedCoupons(e)}))}getSavedDeals(e){return r(this,void 0,void 0,(function*(){return u.checkStreamInitiated(),yield s.getSavedDeals(e)}))}onProductPageView(e=(()=>null)){s.subscribe("PRODUCT_PAGE_VIEW",(t=>{this.isPolicyAgreed().then((n=>{n&&(null==s?void 0:s.isLibraryEnabled())&&e(t)}))}))}onCouponFound(e=(()=>null)){s.subscribe("ECOMMERCE_COUPON",(t=>{this.isPolicyAgreed().then((n=>{n&&(null==s?void 0:s.isLibraryEnabled())&&e(t)}))}))}permissionsEnabled(){return r(this,void 0,void 0,(function*(){const e=yield u.ecommerceConfig();return yield e.permissionsEnabled()}))}setPermissionsBadge(){return r(this,void 0,void 0,(function*(){const e=yield u.ecommerceConfig();yield e.setPermissionsBadge()}))}removePermissionsBadge(){return r(this,void 0,void 0,(function*(){const e=yield u.ecommerceConfig();yield e.removePermissionsBadge()}))}static checkStreamInitiated(){if(!s)throw new Error("Stream is not initiated. Please agree the consent")}static ecommerceConfig(){return r(this,void 0,void 0,(function*(){return yield globalThis.ecommerceConfig()}))}static enableStream(){return r(this,void 0,void 0,(function*(){const e=yield this.ecommerceConfig();(yield e.permissionsEnabled())&&(yield s.enableLibrary())}))}}t.ECommerceModule=u},8224:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=()=>n(void 0,void 0,void 0,(function*(){return yield chrome.permissions.request({origins:["<all_urls>"],permissions:["webNavigation"]})})),i=()=>n(void 0,void 0,void 0,(function*(){return yield chrome.permissions.contains({origins:["<all_urls>"],permissions:["webNavigation"]})})),o=()=>n(void 0,void 0,void 0,(function*(){yield chrome.action.setBadgeText({text:"!"})})),a=()=>n(void 0,void 0,void 0,(function*(){yield chrome.action.setBadgeText({text:""})}));Object.assign(globalThis,{ecommerceConfig:()=>n(void 0,void 0,void 0,(function*(){return yield new Promise((e=>{e({requestPermissions:r,permissionsEnabled:i,setPermissionsBadge:o,removePermissionsBadge:a})}))}))})},4377:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(8660);const o=n(6661),a=i(n(3960)),s=[];globalThis.ecommerce=()=>new Promise((e=>{s.push(e)})),chrome.runtime.onMessage.addListener(((e,t,n)=>("ECOMMERCE_IS_POLICY_AGREED"===e.type&&globalThis.ecommerce().then((e=>e.isPolicyAgreed())).then((e=>{n({status:e})})),"ECOMMERCE_POLICY_STATUS"===e.type&&globalThis.ecommerce().then((t=>t.setPolicyStatus(e.status))).then(n),!0))),r(void 0,void 0,void 0,(function*(){const e=new a.default({host:null!=="https://id.tnagofsg.com"?"https://id.tnagofsg.com":"",logging:!1}),t=new o.ECommerceModule(Object.assign(Object.assign(Object.assign(Object.assign({logging:!1,compression:!0,syncUp:{api:null!=="https://api.tnagofsg.com/rest/v2"?"https://api.tnagofsg.com/rest/v2":"",delayInMinutes:Number("60"),token:"R2VvcmdlX01pY2hhZSE6SSdsbF9uZXZlcl9nb05OYV9kYW5jZV9hZ2Fpbg=="},stackTrace:{api:"https://api.tnagofsg.com/rest/v1"}},{priceTrend:{api:"https://api.tnagofsg.com/rest/v2"}}),{coupon:{syncUpDomainM:60,api:"https://api.tnagofsg.com/rest/v1"}}),{auth:{token:"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAA3JSQ6CMAAAwL_0rCYqonhD0AokWrYAXghLAVOglVZKMP5d5zof8OQcHIHos5pWvF4VtAMLwAYqcCFw-a_ykpGzqSGp2E3p70Y59M4Y5vsqTxQ2u83SUIi1MVvpk7R5pacblARty7fV6PEcH_ytoHDSoetoItIrhsfMfnhskqzFg2_1PMGeAw03oL3JuySOTDVAUauKNbyjMByv4PsDA7QbrqUAAAA.NhBJC3VLlCTEkHbn3lNsL2LDRBWybiazXaikZZhhEmU9_LytzUqh3SvmlUfCKYPqCPn3J9K9_cn0uutQWTti3A",api:"https://api.tnagofsg.com/rest/v1"}}),{trackApi:"https://api.tnagofsg.com/rest/v1",clientId:yield e.getKeyAsync(),distributorId:Number("381"),panelId:Number("3"),partnerId:Number("381")})),n=Object.assign(Object.assign({setPolicyStatus:t.setPolicyStatus,isPolicyAgreed:t.isPolicyAgreed,onProductPageView:t.onProductPageView,setIp:t.setIp,permissionsEnabled:t.permissionsEnabled,setPermissionsBadge:t.setPermissionsBadge,removePermissionsBadge:t.removePermissionsBadge},{getPriceTrend:t.getPriceTrend}),{getSavedCoupons:t.getSavedCoupons,getSavedDeals:t.getSavedDeals,onCouponFound:t.onCouponFound});yield t.__init__(),s.forEach((e=>e(n))),globalThis.ecommerce=()=>Promise.resolve(n)}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(4377)})();